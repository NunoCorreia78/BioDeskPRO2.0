<UserControl x:Class="BioDesk.App.Controls.MultiSelectChips"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008">

    <UserControl.Resources>
        <!-- Estilo para chips selecionáveis -->
        <Style x:Key="ChipToggleButtonStyle" TargetType="ToggleButton">
            <Setter Property="Background" Value="#F7F9F6"/>
            <Setter Property="BorderBrush" Value="#E3E9DE"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#5A6558"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4,2"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Normal"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ToggleButton">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="16"
                                SnapsToDevicePixels="true">
                            <ContentPresenter x:Name="contentPresenter"
                                            Focusable="False"
                                            HorizontalAlignment="Center"
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"
                                            RecognizesAccessKey="True"
                                            SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Background" TargetName="border" Value="#E8EDE6"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#9CAF97"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="true">
                                <Setter Property="Background" TargetName="border" Value="#D4E2D1"/>
                            </Trigger>
                            <Trigger Property="IsChecked" Value="true">
                                <Setter Property="Background" TargetName="border" Value="#9CAF97"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#879B83"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="false">
                                <Setter Property="Background" TargetName="border" Value="#F0F0F0"/>
                                <Setter Property="BorderBrush" TargetName="border" Value="#D0D0D0"/>
                                <Setter Property="Foreground" Value="#A0A0A0"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Título -->
        <TextBlock Grid.Row="0" 
                   Text="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=Title}"
                   FontSize="14" 
                   FontWeight="SemiBold" 
                   Foreground="#3F4A3D"
                   Margin="0,0,0,8"/>

        <!-- Container scrollável para chips -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      MaxHeight="200">
            <ItemsControl x:Name="ChipsContainer" 
                          ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=Items}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <ToggleButton Style="{StaticResource ChipToggleButtonStyle}"
                                      Content="{Binding Texto}"
                                      IsChecked="{Binding IsSelecionado, Mode=TwoWay}"
                                      Command="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=ChipToggledCommand}"
                                      CommandParameter="{Binding}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>