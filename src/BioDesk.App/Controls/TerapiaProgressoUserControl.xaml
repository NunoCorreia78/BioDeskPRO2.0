<UserControl x:Class="BioDesk.App.Controls.TerapiaProgressoUserControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             x:Name="RootControl"
             d:DesignHeight="150"
        d:DesignWidth="1200">

    <!-- CARD DE PROGRESSO - Sempre visível, expande quando TerapiaEmAndamento=True -->
    <Border Background="{DynamicResource Cartao}"
            BorderBrush="{DynamicResource Borda}"
            BorderThickness="2"
            CornerRadius="8"
            Padding="15">
        <Grid>
            <!-- Quando INATIVO: Mostrar placeholder compacto -->
            <StackPanel Visibility="{Binding ElementName=RootControl, Path=TerapiaEmAndamento, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                <TextBlock Text="⏸ Aguardando início da terapia..."
                           FontSize="13"
                           Foreground="{DynamicResource TextoSecundario}"
                           HorizontalAlignment="Center"
                           FontStyle="Italic"
                           Margin="0,10"/>
            </StackPanel>

            <!-- Quando ATIVO: Mostrar progresso completo -->
            <StackPanel Visibility="{Binding ElementName=RootControl, Path=TerapiaEmAndamento, Converter={StaticResource BoolToVisibilityConverter}}">
                <!-- Cabeçalho -->
                <TextBlock Text="⚡ TERAPIA EM ANDAMENTO"
                           FontSize="15"
                        FontWeight="Bold"
                           Foreground="#9CAF97"
                           HorizontalAlignment="Center"
                           Margin="0,0,0,10"/>

                <!-- Grid com 2 colunas: Info à esquerda, Progresso à direita -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="20"/>
                        <ColumnDefinition Width="400"/>
                    </Grid.ColumnDefinitions>

                    <!-- COLUNA ESQUERDA: Informações em tempo real -->
                    <StackPanel Grid.Column="0">
                        <!-- Frequência Atual (COM variação) -->
                        <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,6">
                            <TextBlock Text="🎵 Frequência:"
                                       FontSize="13"
                                    FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextoPrincipal}"
                                       Width="100"/>
                            <TextBlock FontSize="13"
                                    Foreground="{DynamicResource TextoSecundario}">
                                <Run Text="{Binding ElementName=RootControl, Path=FrequenciaAtualHz, StringFormat='{}{0:F2} Hz', Mode=OneWay}"
                                        FontWeight="Bold"
                                        Foreground="#9CAF97"/>
                                <Run Text=" (Original: "
                                        Foreground="{DynamicResource TextoSecundario}"/>
                                <Run Text="{Binding ElementName=RootControl, Path=FrequenciaOriginalHz, StringFormat='{}{0:F2} Hz', Mode=OneWay}"/>
                                <Run Text=", Ajuste: "
                                        Foreground="{DynamicResource TextoSecundario}"/>
                                <Run Text="{Binding ElementName=RootControl, Path=AjusteAplicadoHz, StringFormat='{}{0:+0.0;-0.0;±0.0} Hz', Mode=OneWay}"
                                        Foreground="#7B8FA3"/>
                                <Run Text=")"
                                        Foreground="{DynamicResource TextoSecundario}"/>
                            </TextBlock>
                        </StackPanel>

                        <!-- Programa/Protocolo Atual -->
                        <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,6"
                                    Visibility="{Binding ElementName=RootControl, Path=MostrarPrograma, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="📋 Programa:"
                                       FontSize="13"
                                    FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextoPrincipal}"
                                       Width="100"/>
                            <TextBlock Text="{Binding ElementName=RootControl, Path=ProgramaAtual, Mode=OneWay}"
                                       FontSize="13"
                                       Foreground="{DynamicResource TextoSecundario}"
                                       TextWrapping="Wrap"
                                       MaxWidth="500"/>
                        </StackPanel>

                        <!-- Progresso (nº frequências) -->
                        <StackPanel Orientation="Horizontal"
                                Margin="0,0,0,6">
                            <TextBlock Text="📊 Progresso:"
                                       FontSize="13"
                                    FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextoPrincipal}"
                                       Width="100"/>
                            <TextBlock FontSize="13"
                                    Foreground="{DynamicResource TextoSecundario}">
                                <Run Text="{Binding ElementName=RootControl, Path=FrequenciaAtualIndex, Mode=OneWay}"
                                        FontWeight="Bold"
                                        Foreground="#9CAF97"/>
                                <Run Text="/"/>
                                <Run Text="{Binding ElementName=RootControl, Path=TotalFrequencias, Mode=OneWay}"/>
                                <Run Text=" frequências ("/>
                                <Run Text="{Binding ElementName=RootControl, Path=ProgressoPercentual, StringFormat='{}{0:F1}%', Mode=OneWay}"
                                        FontWeight="Bold"/>
                                <Run Text=")"/>
                            </TextBlock>
                        </StackPanel>

                        <!-- Tempo Restante -->
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="⏱ Falta:"
                                       FontSize="13"
                                    FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextoPrincipal}"
                                       Width="100"/>
                            <TextBlock Text="{Binding ElementName=RootControl, Path=TempoRestanteFormatado, Mode=OneWay}"
                                       FontSize="13"
                                    FontWeight="Bold"
                                       Foreground="#7B8FA3"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- COLUNA DIREITA: Barra de Progresso -->
                    <StackPanel Grid.Column="2"
                            VerticalAlignment="Center">
                        <ProgressBar Value="{Binding ElementName=RootControl, Path=ProgressoPercentual, Mode=OneWay}"
                                     Maximum="100"
                                     Height="30"
                                     Background="#E3E9DE"
                                     Foreground="#9CAF97"
                                     BorderThickness="1"
                                     BorderBrush="#D0D7CC"/>
                        <TextBlock Text="{Binding ElementName=RootControl, Path=ProgressoPercentual, StringFormat='{}{0:F1}%', Mode=OneWay}"
                                   FontSize="12"
                                FontWeight="Bold"
                                   Foreground="{DynamicResource TextoPrincipal}"
                                   HorizontalAlignment="Center"
                                   Margin="0,5,0,0"/>
                    </StackPanel>
                </Grid>
            </StackPanel>
        </Grid>
    </Border>
</UserControl>
