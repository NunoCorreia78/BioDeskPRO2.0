<UserControl
    x:Class="BioDesk.App.Views.Terapia.BiofeedbackView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:BioDesk.ViewModels.UserControls.Terapia;assembly=BioDesk.ViewModels"
    xmlns:controls="clr-namespace:BioDesk.App.Controls"
    d:DataContext="{d:DesignInstance Type=vm:BiofeedbackViewModel}"
    mc:Ignorable="d">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Controlos compactos -->
            <RowDefinition Height="Auto"/> <!-- Progresso -->
            <RowDefinition Height="*"/>    <!-- BotÃ£o Iniciar SessÃ£o + Info -->
        </Grid.RowDefinitions>

        <!-- ROW 0: CONTROLOS COMPACTOS -->
        <controls:TerapiaControlosCompactoUserControl x:Name="TerapiaControlosCompacto"
                                                      Grid.Row="0"
                                                      VoltagemV="5.0"
                                                      DuracaoTotalMinutos="30"
                                                      TempoFrequenciaSegundos="10"
                                                      AjusteHz="0"
                                                      TextoBotao="Terapia RÃ¡pida"
                                                      IniciarClick="TerapiaControlos_IniciarClick"
                                                      PararClick="TerapiaControlos_PararClick"
                                                      Margin="0,0,0,15"/>

        <!-- ROW 1: PROGRESSO (sem linha de programa) -->
        <controls:TerapiaProgressoUserControl x:Name="TerapiaProgresso"
                                              Grid.Row="1"
                                              TerapiaEmAndamento="{Binding SessaoEmAndamento}"
                                              FrequenciaAtualHz="{Binding FrequenciaAtualHz}"
                                              FrequenciaOriginalHz="{Binding FrequenciaOriginalHz}"
                                              AjusteAplicadoHz="{Binding AjusteHz}"
                                              MostrarPrograma="False"
                                              FrequenciaAtualIndex="{Binding FrequenciaAtualIndex}"
                                              TotalFrequencias="{Binding TotalFrequencias}"
                                              ProgressoPercentual="{Binding ProgressoPercentual}"
                                              TempoRestanteFormatado="{Binding TempoRestanteFormatado}"
                                              Margin="0,0,0,15"/>

        <!-- ROW 2: BotÃ£o Iniciar SessÃ£o + InformaÃ§Ã£o Minimalista -->
        <Border Grid.Row="2"
                Background="{DynamicResource Cartao}"
                BorderBrush="{DynamicResource Borda}"
                BorderThickness="2"
                CornerRadius="8"
                Padding="15">
            <StackPanel>
                <TextBlock Text="BIOFEEDBACK AUTÃ“NOMO"
                           FontSize="16" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextoPrincipal}"
                           Margin="0,0,0,15"/>

                <!-- BotÃ£o Iniciar SessÃ£o AutÃ³noma -->
                <Button Content="ðŸ”„ Iniciar SessÃ£o Biofeedback"
                        Command="{Binding IniciarSessaoCommand}"
                        Height="45"
                        Margin="0,0,0,10"
                        Background="#9CAF97"
                        Foreground="White"
                        FontSize="15"
                        FontWeight="SemiBold"
                        BorderThickness="0"
                        Cursor="Hand"
                        ToolTip="Abre modal para sessÃ£o autÃ³noma: scan ressonantes â†’ emissÃ£o â†’ repetir">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="6"
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#879B83"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <TextBlock Text="ðŸ’¡ SessÃ£o loop: scan â†’ emissÃ£o â†’ re-scan â†’ repetir (atÃ© parar)"
                           FontSize="11"
                           Foreground="{DynamicResource TextoSecundario}"
                           Margin="0,0,0,10"/>

                <TextBlock Text="âœ¨ Interface Minimalista"
                           FontSize="13" FontWeight="SemiBold"
                           Foreground="{DynamicResource TextoPrincipal}"
                           Margin="0,10,0,5"/>

                <TextBlock Text="Durante a terapia, acompanhe a frequÃªncia atual e progresso no painel acima. A interface foi simplificada para focar apenas na emissÃ£o em tempo real."
                           FontSize="11"
                           Foreground="{DynamicResource TextoSecundario}"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
