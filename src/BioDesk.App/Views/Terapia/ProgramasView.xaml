<UserControl
    x:Class="BioDesk.App.Views.Terapia.ProgramasView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:BioDesk.ViewModels.UserControls.Terapia;assembly=BioDesk.ViewModels"
    xmlns:controls="clr-namespace:BioDesk.App.Controls"
    d:DataContext="{d:DesignInstance Type=vm:ProgramasViewModel}"
    mc:Ignorable="d">

    <Grid Margin="20">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" MinWidth="400"/>
            <ColumnDefinition Width="20"/>
            <ColumnDefinition Width="1*" MinWidth="300"/>
        </Grid.ColumnDefinitions>

        <!-- ESQUERDA: Lista de Programas com Checkboxes -->
        <Border Grid.Column="0"
                Background="{DynamicResource Cartao}"
                BorderBrush="{DynamicResource Borda}"
                BorderThickness="2"
                CornerRadius="8"
                Padding="15">
            <DockPanel>
                <!-- CabeÃ§alho + Pesquisa -->
                <StackPanel DockPanel.Dock="Top" Margin="0,0,0,15">
                    <TextBlock Text="PROGRAMAS TERAPÃŠUTICOS"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextoPrincipal}"
                               Margin="0,0,0,10"/>

                    <TextBox Text="{Binding Search, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Height="35"
                             FontSize="14"
                             VerticalContentAlignment="Center"
                             Padding="10,0"
                             Margin="0,0,0,5">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background" Value="#F7F9F6"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <TextBlock Text="ðŸ’¡ Selecione programas (Ctrl+Click ou Shift+Click para mÃºltiplos)"
                               FontSize="10"
                               Foreground="{DynamicResource TextoSecundario}"
                               Margin="2,0,0,0"/>
                </StackPanel>

                <!-- DataGrid com SeleÃ§Ã£o Nativa (Ctrl+Click / Shift+Click) -->
                <DataGrid x:Name="ProgramasDataGrid"
                         ItemsSource="{Binding Programs}"
                         SelectionMode="Extended"
                         SelectionChanged="ProgramasDataGrid_SelectionChanged"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         GridLinesVisibility="Horizontal"
                         RowBackground="White"
                         AlternatingRowBackground="#FAFBFA"
                         HeadersVisibility="None"
                         BorderThickness="0"
                         CanUserResizeColumns="False"
                         CanUserResizeRows="False"
                         CanUserReorderColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Width="*" Binding="{Binding}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="FontWeight" Value="Medium"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextoPrincipal}"/>
                                    <Setter Property="Padding" Value="10,8"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>

        <!-- DIREITA: Controlos Unificados + Progresso -->
        <ScrollViewer Grid.Column="2"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled">
            <StackPanel>
                <!-- Painel de Progresso em Tempo Real -->
            <Border Background="{DynamicResource Cartao}"
                    BorderBrush="{DynamicResource Borda}"
                    BorderThickness="2"
                    CornerRadius="8"
                    Padding="15"
                    Margin="0,0,0,15"
                    Visibility="{Binding TerapiaEmAndamento, Converter={StaticResource BoolToVisibilityConverter}}">
                <StackPanel>
                    <TextBlock Text="âš¡ TERAPIA EM ANDAMENTO"
                               FontSize="14" FontWeight="SemiBold"
                               Foreground="#9CAF97"
                               Margin="0,0,0,10"/>

                    <!-- Programa Atual -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Programa:"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextoPrincipal}"
                                   Width="90"/>
                        <TextBlock Text="{Binding ProgramaAtual}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- FrequÃªncia Atual -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="FrequÃªncia:"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextoPrincipal}"
                                   Width="90"/>
                        <TextBlock Text="{Binding FrequenciaAtual}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"
                                   TextWrapping="Wrap"/>
                    </StackPanel>

                    <!-- Progresso -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Progresso:"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextoPrincipal}"
                                   Width="90"/>
                        <TextBlock Text="{Binding FrequenciaAtualIndex}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"/>
                        <TextBlock Text="/"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"
                                   Margin="2,0"/>
                        <TextBlock Text="{Binding TotalFrequencias}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"/>
                    </StackPanel>

                    <!-- Tempo Restante -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="Tempo restante:"
                                   FontSize="12" FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextoPrincipal}"
                                   Width="90"/>
                        <TextBlock Text="{Binding TempoRestanteSegundos}"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"/>
                        <TextBlock Text="s"
                                   FontSize="12"
                                   Foreground="{DynamicResource TextoSecundario}"
                                   Margin="2,0,0,0"/>
                    </StackPanel>

                    <!-- Barra de Progresso -->
                    <ProgressBar Value="{Binding ProgressoPercentual}"
                                 Maximum="100"
                                 Height="20"
                                 Background="#E3E9DE"
                                 Foreground="#9CAF97"/>
                    <TextBlock Text="{Binding ProgressoPercentual, StringFormat='{}{0:F1}%'}"
                               FontSize="11"
                               Foreground="{DynamicResource TextoSecundario}"
                               HorizontalAlignment="Center"
                               Margin="0,3,0,0"/>
                </StackPanel>
            </Border>

            <controls:TerapiaControlosUserControl x:Name="TerapiaControlos"
                                                 VoltagemV="5.0"
                                                 DuracaoTotalMinutos="30"
                                                 TempoFrequenciaSegundos="10"
                                                 AjusteHz="0"
                                                 TextoBotao="Iniciar Programas"
                                                 IniciarClick="TerapiaControlos_IniciarClick"
                                                 PararClick="TerapiaControlos_PararClick"/>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
