<UserControl
    x:Class="BioDesk.App.Views.Terapia.ProgramasView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="clr-namespace:BioDesk.ViewModels.UserControls.Terapia;assembly=BioDesk.ViewModels"
    xmlns:controls="clr-namespace:BioDesk.App.Controls"
    d:DataContext="{d:DesignInstance Type=vm:ProgramasViewModel}"
    mc:Ignorable="d">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Controlos Compactos -->
            <RowDefinition Height="Auto"/> <!-- Progresso -->
            <RowDefinition Height="*"/>    <!-- Lista Programas -->
        </Grid.RowDefinitions>

        <!-- LINHA 1: Controlos Compactos (Horizontal) -->
        <controls:TerapiaControlosCompactoUserControl x:Name="TerapiaControlosCompacto"
                                                      Grid.Row="0"
                                                      VoltagemV="{Binding VoltagemSelecionada, Mode=TwoWay}"
                                                      DuracaoTotalMinutos="{Binding DuracaoTotal, Mode=TwoWay}"
                                                      TempoFrequenciaSegundos="{Binding TempoFrequencia, Mode=TwoWay}"
                                                      AjusteHz="{Binding AjusteHz, Mode=TwoWay}"
                                                      TextoBotao="Iniciar Programas"
                                                      IniciarClick="TerapiaControlos_IniciarClick"
                                                      PararClick="TerapiaControlos_PararClick"
                                                      Margin="0,0,0,15"/>

        <!-- LINHA 2: Progresso Sempre VisÃ­vel -->
        <controls:TerapiaProgressoUserControl x:Name="TerapiaProgresso"
                                              Grid.Row="1"
                                              TerapiaEmAndamento="{Binding TerapiaEmAndamento}"
                                              FrequenciaAtualHz="{Binding FrequenciaAtualHz}"
                                              FrequenciaOriginalHz="{Binding FrequenciaOriginalHz}"
                                              AjusteAplicadoHz="{Binding AjusteHz}"
                                              ProgramaAtual="{Binding ProgramaAtual}"
                                              MostrarPrograma="True"
                                              FrequenciaAtualIndex="{Binding FrequenciaAtualIndex}"
                                              TotalFrequencias="{Binding TotalFrequencias}"
                                              ProgressoPercentual="{Binding ProgressoPercentual}"
                                              TempoRestanteFormatado="{Binding TempoRestanteFormatado}"
                                              Margin="0,0,0,15"/>

        <!-- LINHA 3: Lista de Programas -->
        <Border Grid.Row="2"
                Background="{DynamicResource Cartao}"
                BorderBrush="{DynamicResource Borda}"
                BorderThickness="2"
                CornerRadius="8"
                Padding="15">
            <DockPanel>
                <!-- CabeÃ§alho + Pesquisa -->
                <StackPanel DockPanel.Dock="Top" Margin="0,0,0,15">
                    <TextBlock Text="PROGRAMAS TERAPÃŠUTICOS"
                               FontSize="16" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextoPrincipal}"
                               Margin="0,0,0,10"/>

                    <TextBox Text="{Binding Search, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             Height="35"
                             FontSize="14"
                             VerticalContentAlignment="Center"
                             Padding="10,0"
                             Margin="0,0,0,5">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Background" Value="White"/>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="">
                                        <Setter Property="Background" Value="#F7F9F6"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>

                    <TextBlock Text="ðŸ’¡ Selecione programas (Ctrl+Click ou Shift+Click para mÃºltiplos)"
                               FontSize="10"
                               Foreground="{DynamicResource TextoSecundario}"
                               Margin="2,0,0,0"/>
                </StackPanel>

                <!-- DataGrid com SeleÃ§Ã£o Nativa (Ctrl+Click / Shift+Click) -->
                <DataGrid x:Name="ProgramasDataGrid"
                         ItemsSource="{Binding Programs}"
                         SelectionMode="Extended"
                         SelectionChanged="ProgramasDataGrid_SelectionChanged"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         GridLinesVisibility="Horizontal"
                         RowBackground="White"
                         AlternatingRowBackground="#FAFBFA"
                         HeadersVisibility="None"
                         BorderThickness="0"
                         CanUserResizeColumns="False"
                         CanUserResizeRows="False"
                         CanUserReorderColumns="False">
                    <DataGrid.Columns>
                        <DataGridTextColumn Width="*" Binding="{Binding}">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="FontWeight" Value="Medium"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextoPrincipal}"/>
                                    <Setter Property="Padding" Value="10,8"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
