<UserControl
  x:Class="BioDesk.App.Views.FichaPacienteView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:abas="clr-namespace:BioDesk.App.Views.Abas"
  xmlns:converters="clr-namespace:BioDesk.App.Converters"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="800"
  d:DesignWidth="1200"
  mc:Ignorable="d">

  <UserControl.Resources>
    <!--  Cores do tema  -->
    <SolidColorBrush x:Key="TextoPrincipal">#3F4A3D</SolidColorBrush>
    <SolidColorBrush x:Key="TextoSecundario">#5A6558</SolidColorBrush>

    <!--  Converter para progresso das abas  -->
    <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
    <converters:TabStyleConverter x:Key="TabStyleConverter" />
    <converters:StringParameterToVisibilityConverter x:Key="StringParameterToVisibilityConverter" />

    <!--  DataTemplate para Aba 1: Dados Biográficos  -->
    <DataTemplate x:Key="DadosBiograficosTemplate">
      <abas:DadosBiograficosUserControl />
    </DataTemplate>

    <!--  DataTemplate para conteúdo de texto simples (outras abas)  -->
    <DataTemplate x:Key="ConteudoTextoTemplate">
      <TextBlock
        Margin="20"
        FontSize="16"
        Foreground="{StaticResource TextoPrincipal}"
        Text="{Binding}"
        TextWrapping="Wrap" />
    </DataTemplate>

    <!--  Style para separadores INATIVOS - CARTÕES FLUTUANTES MODERNOS  -->
    <Style x:Key="TabButtonStyle" TargetType="Button">
      <Setter Property="Background">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Offset="0" Color="White" />
            <GradientStop Offset="1" Color="#F8FAF7" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
      <Setter Property="Foreground" Value="{StaticResource TextoSecundario}" />
      <Setter Property="BorderBrush" Value="#D6E2D3" />
      <Setter Property="BorderThickness" Value="1" />
      <Setter Property="Padding" Value="16,12,16,12" />
      <Setter Property="Margin" Value="4,4,4,0" />
      <Setter Property="FontSize" Value="13" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="MinWidth" Value="110" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border
              Background="{TemplateBinding Background}"
              BorderBrush="{TemplateBinding BorderBrush}"
              BorderThickness="{TemplateBinding BorderThickness}"
              CornerRadius="12">
              <ContentPresenter
                Margin="{TemplateBinding Padding}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center" />
              <Border.Effect>
                <DropShadowEffect
                  BlurRadius="8"
                  Opacity="0.25"
                  ShadowDepth="2"
                  Color="#C0C8C0" />
              </Border.Effect>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background">
                  <Setter.Value>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                      <GradientStop Offset="0" Color="White" />
                      <GradientStop Offset="1" Color="#F0F6EE" />
                    </LinearGradientBrush>
                  </Setter.Value>
                </Setter>
                <Setter Property="Foreground" Value="{StaticResource TextoPrincipal}" />
                <Setter Property="BorderBrush" Value="{StaticResource BotaoPrincipal}" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Style para separador ATIVO - CARTÃO PREMIUM DESTAQUE  -->
    <Style
      x:Key="TabButtonActiveStyle"
      BasedOn="{StaticResource TabButtonStyle}"
      TargetType="Button">
      <Setter Property="Background">
        <Setter.Value>
          <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
            <GradientStop Offset="0" Color="#9CAF97" />
            <GradientStop Offset="1" Color="#87A082" />
          </LinearGradientBrush>
        </Setter.Value>
      </Setter>
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderBrush" Value="#7A9074" />
      <Setter Property="BorderThickness" Value="2" />
      <Setter Property="FontWeight" Value="SemiBold" />
      <Setter Property="Margin" Value="8,4,8,0" />
      <Setter Property="Effect">
        <Setter.Value>
          <DropShadowEffect
            BlurRadius="12"
            Opacity="0.4"
            ShadowDepth="3"
            Color="#9CAF97" />
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Style para botões de navegação no rodapé - DESIGN MODERNO  -->
    <Style x:Key="NavigationButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="{StaticResource BotaoPrincipal}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="24,12" />
      <Setter Property="Margin" Value="12,8" />
      <Setter Property="FontSize" Value="13" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="MinWidth" Value="140" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" CornerRadius="25">
              <ContentPresenter
                Margin="{TemplateBinding Padding}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center" />
              <Border.Effect>
                <DropShadowEffect
                  BlurRadius="12"
                  Opacity="0.2"
                  ShadowDepth="3"
                  Color="#B8C5B3" />
              </Border.Effect>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="{StaticResource BotaoHover}" />
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#7A8D76" />
              </Trigger>
              <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Background" Value="#D5DDD2" />
                <Setter Property="Foreground" Value="#8A9487" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Style para botão secundário (Guardar Rascunho)  -->
    <Style
      x:Key="SecondaryButtonStyle"
      BasedOn="{StaticResource NavigationButtonStyle}"
      TargetType="Button">
      <Setter Property="Background" Value="#E8F2E5" />
      <Setter Property="Foreground" Value="{StaticResource BotaoPrincipal}" />
    </Style>
  </UserControl.Resources>

  <Grid Background="{StaticResource FundoPrincipal}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <!--  Separadores/Abas  -->
      <RowDefinition Height="*" />
      <!--  Conteúdo da Aba  -->
      <RowDefinition Height="Auto" />
      <!--  Rodapé de Navegação  -->
    </Grid.RowDefinitions>

    <!--  === SEPARADORES/ABAS - DESIGN CARTÕES FLUTUANTES PREMIUM ===  -->
    <Border Grid.Row="0" Padding="24,16,24,8">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
          <GradientStop Offset="0" Color="#F5F8F4" />
          <GradientStop Offset="1" Color="#EDF2EB" />
        </LinearGradientBrush>
      </Border.Background>
      <!--  WrapPanel permite quebra automática sem scrollbar  -->
      <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal">
        <Button
          x:Name="BtnAba1"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="1"
          Content="👤 Dados">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="1">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba2"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="2"
          Content="📋 Saúde">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="2">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba3"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="3"
          Content="📜 Consents">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="3">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba4"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="4"
          Content="📋 Consultas">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="4">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba5"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="5"
          Content="👁️ Íris">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="5">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba6"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="6"
          Content="📧 Emails">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="6">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba7"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="7"
          Content="🌿 Terapias"
          ToolTip="Terapias Bioenergéticas (Inergetix-CoRe)">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="7">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>
      </WrapPanel>
    </Border>

    <!--  === CONTEÚDO DA ABA ATIVA ===  -->
    <Border
      Grid.Row="1"
      Padding="0"
      Background="{StaticResource FundoPrincipal}">

      <!--  Conteúdo dinâmico baseado na aba ativa  -->
      <Grid>
        <!--  UserControl para Aba 1: Dados Biográficos  -->
        <abas:DadosBiograficosUserControl
          x:Name="DadosBiograficosUserControl"
          Panel.ZIndex="100"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=1}" />

        <!--  UserControl para Aba 2: Declaração de Saúde  -->
        <abas:DeclaracaoSaudeUserControl
          x:Name="DeclaracaoSaudeUserControl"
          Panel.ZIndex="50"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=2}" />

        <!--  UserControl para Aba 3: Consentimentos  -->
        <abas:ConsentimentosUserControl
          x:Name="ConsentimentosUserControl"
          Panel.ZIndex="25"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=3}" />

        <!--  UserControl para Aba 4: Registo de Consultas/Sessões  -->
        <abas:RegistoConsultasUserControl
          x:Name="RegistoConsultasUserControl"
          Panel.ZIndex="26"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=4}" />

        <!--  UserControl para Aba 5: Irisdiagnóstico  -->
        <abas:IrisdiagnosticoUserControl
          x:Name="IrisdiagnosticoUserControl"
          Panel.ZIndex="22"
          Background="Transparent"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=5}" />

        <!--  UserControl para Aba 6: Comunicação  -->
        <abas:ComunicacaoUserControl
          x:Name="ComunicacaoUserControl"
          Panel.ZIndex="20"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=6}" />

        <!--  UserControl para Aba 7: Terapias Bioenergéticas  -->
        <abas:TerapiaBioenergeticaUserControl
          x:Name="TerapiaBioenergeticaUserControl"
          Panel.ZIndex="15"
          Background="Transparent"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=7}" />
      </Grid>

    </Border>

    <!--  === RODAPÉ DE NAVEGAÇÃO ===  -->
    <Border
      Grid.Row="2"
      Padding="20,12"
      Background="{StaticResource CartaoBrush}"
      BorderBrush="{StaticResource BordaBrush}"
      BorderThickness="0,2,0,0">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Botões Esquerda  -->
        <StackPanel
          Grid.Column="0"
          HorizontalAlignment="Left"
          Orientation="Horizontal">
          <Button
            Margin="0,0,12,0"
            Command="{Binding VoltarDashboardCommand}"
            Content="🏠 Home"
            Style="{StaticResource SecondaryButtonStyle}"
            ToolTip="Voltar ao Dashboard (protege alterações não guardadas)" />
          <Button
            Command="{Binding AbaAnteriorCommand}"
            Content="⬅️ Anterior"
            Style="{StaticResource SecondaryButtonStyle}" />
        </StackPanel>

        <!--  Botões Centro - SISTEMA DE GRAVAÇÃO MANUAL  -->
        <StackPanel
          Grid.Column="1"
          HorizontalAlignment="Center"
          Orientation="Horizontal">
          <Button
            Command="{Binding GuardarRascunhoCommand}"
            Content="💾 Guardar"
            Style="{StaticResource SecondaryButtonStyle}"
            ToolTip="Guardar paciente (Ctrl+S)" />
          <TextBlock
            Margin="12,0,0,0"
            VerticalAlignment="Center"
            FontSize="11"
            Foreground="{StaticResource TextoSecundario}"
            Text="{Binding StatusSave, FallbackValue='Pronto'}" />
        </StackPanel>

        <!--  Botões Direita  -->
        <StackPanel
          Grid.Column="2"
          HorizontalAlignment="Right"
          Orientation="Horizontal">
          <Button
            Command="{Binding ProximaAbaCommand}"
            Content="Seguinte ➡️"
            IsEnabled="{Binding PodeAvancarAba}"
            Style="{StaticResource NavigationButtonStyle}" />
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>
