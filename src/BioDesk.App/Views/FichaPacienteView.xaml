<UserControl
  x:Class="BioDesk.App.Views.FichaPacienteView"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:abas="clr-namespace:BioDesk.App.Views.Abas"
  xmlns:converters="clr-namespace:BioDesk.App.Converters"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  d:DesignHeight="800"
  d:DesignWidth="1200"
  Background="{DynamicResource FundoPrincipal}"
  mc:Ignorable="d">

  <UserControl.Resources>
    <!--  Cores do tema  -->
    <SolidColorBrush x:Key="TextoPrincipal">#3F4A3D</SolidColorBrush>
    <SolidColorBrush x:Key="TextoSecundario">#5A6558</SolidColorBrush>

    <!--  Converters: BoolToVisibilityConverter já no App.xaml linha 28  -->
    <!--  Converter local específico para estilo das abas  -->
    <converters:TabStyleConverter x:Key="TabStyleConverter" />

    <!--  DataTemplate para Aba 1: Dados Biogr├íficos  -->
    <DataTemplate x:Key="DadosBiograficosTemplate">
      <abas:DadosBiograficosUserControl />
    </DataTemplate>

    <!--  DataTemplate para conte├║do de texto simples (outras abas)  -->
    <DataTemplate x:Key="ConteudoTextoTemplate">
      <TextBlock
        Margin="20"
        FontSize="16"
        Foreground="{StaticResource TextoPrincipal}"
        Text="{Binding}"
        TextWrapping="Wrap" />
    </DataTemplate>

      <!--  TabButtonStyle e TabButtonActiveStyle migrados para App.xaml (recursos globais)  -->
  <!--  Motivo: TabStyleConverter usa Application.Current.TryFindResource() que só encontra recursos em Application.Resources  -->



    <!--  Style para bot├Áes de navega├º├úo no rodap├® - DESIGN MODERNO  -->
    <Style x:Key="NavigationButtonStyle" TargetType="Button">
      <Setter Property="Background" Value="{StaticResource BotaoPrincipal}" />
      <Setter Property="Foreground" Value="White" />
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="Padding" Value="24,12" />
      <Setter Property="Margin" Value="12,8" />
      <Setter Property="FontSize" Value="13" />
      <Setter Property="FontWeight" Value="Medium" />
      <Setter Property="MinWidth" Value="140" />
      <Setter Property="Template">
        <Setter.Value>
          <ControlTemplate TargetType="Button">
            <Border Background="{TemplateBinding Background}" CornerRadius="25">
              <ContentPresenter
                Margin="{TemplateBinding Padding}"
                HorizontalAlignment="Center"
                VerticalAlignment="Center" />
              <Border.Effect>
                <DropShadowEffect
                  BlurRadius="12"
                  Opacity="0.2"
                  ShadowDepth="3"
                  Color="#B8C5B3" />
              </Border.Effect>
            </Border>
            <ControlTemplate.Triggers>
              <Trigger Property="IsMouseOver" Value="True">
                <Setter Property="Background" Value="{StaticResource BotaoHover}" />
              </Trigger>
              <Trigger Property="IsPressed" Value="True">
                <Setter Property="Background" Value="#7A8D76" />
              </Trigger>
              <Trigger Property="IsEnabled" Value="False">
                <Setter Property="Background" Value="#D5DDD2" />
                <Setter Property="Foreground" Value="#8A9487" />
              </Trigger>
            </ControlTemplate.Triggers>
          </ControlTemplate>
        </Setter.Value>
      </Setter>
    </Style>

    <!--  Style para bot├úo secund├írio (Guardar Rascunho)  -->
    <Style
      x:Key="SecondaryButtonStyle"
      BasedOn="{StaticResource NavigationButtonStyle}"
      TargetType="Button">
      <Setter Property="Background" Value="#E8F2E5" />
      <Setter Property="Foreground" Value="{StaticResource BotaoPrincipal}" />
    </Style>
  </UserControl.Resources>

  <Grid Panel.ZIndex="100" Background="{DynamicResource FundoPrincipal}">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto" />
      <!--  Separadores/Abas  -->
      <RowDefinition Height="*" />
      <!--  Conte├║do da Aba  -->
      <RowDefinition Height="Auto" />
      <!--  Rodap├® de Navega├º├úo  -->
    </Grid.RowDefinitions>

    <!--  === SEPARADORES/ABAS - DESIGN CART├òES FLUTUANTES PREMIUM ===  -->
    <Border Grid.Row="0" Padding="24,16,24,8">
      <Border.Background>
        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
          <GradientStop Offset="0" Color="#F5F8F4" />
          <GradientStop Offset="1" Color="#EDF2EB" />
        </LinearGradientBrush>
      </Border.Background>
      <!--  WrapPanel permite quebra autom├ítica sem scrollbar  -->
      <WrapPanel HorizontalAlignment="Center" Orientation="Horizontal">
        <Button
          x:Name="BtnAba1"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="1"
          Content="📋 Dados">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="1">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba2"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="2"
          Content="🏥 Saúde">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="2">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba3"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="3"
          Content="📄 Consentimentos">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="3">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba4"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="4"
          Content="🏥 Consultas">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="4">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba5"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="5"
          Content="👁️ Íris">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="5">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba6"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="6"
          Content="📧 Emails">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="6">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>

        <Button
          x:Name="BtnAba7"
          Command="{Binding NavegarParaAbaCommand}"
          CommandParameter="7"
          Content="🌿 Terapias"
          ToolTip="Gestão de protocolos terapêuticos bioenergéticos">
          <Button.Style>
            <Style BasedOn="{StaticResource TabButtonStyle}" TargetType="Button">
              <Style.Triggers>
                <DataTrigger Binding="{Binding AbaAtiva}" Value="7">
                  <Setter Property="Background">
                    <Setter.Value>
                      <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                        <GradientStop Offset="0" Color="#9CAF97" />
                        <GradientStop Offset="1" Color="#87A082" />
                      </LinearGradientBrush>
                    </Setter.Value>
                  </Setter>
                  <Setter Property="Foreground" Value="White" />
                  <Setter Property="FontWeight" Value="SemiBold" />
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </Button.Style>
        </Button>
      </WrapPanel>
    </Border>

    <!--  === CONTE├ÜDO DA ABA ATIVA ===  -->
    <Border
      Grid.Row="1"
      Padding="0"
      Background="{StaticResource FundoPrincipal}">

      <!--  Conte├║do din├ómico baseado na aba ativa  -->
      <Grid>
        <!--  UserControl para Aba 1: Dados Biogr├íficos  -->
        <abas:DadosBiograficosUserControl
          x:Name="DadosBiograficosUserControl"
          Panel.ZIndex="100"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=1}" />

        <!--  UserControl para Aba 2: Declara├º├úo de Sa├║de  -->
        <abas:DeclaracaoSaudeUserControl
          x:Name="DeclaracaoSaudeUserControl"
          Panel.ZIndex="50"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=2}" />

        <!--  UserControl para Aba 3: Consentimentos  -->
        <abas:ConsentimentosUserControl
          x:Name="ConsentimentosUserControl"
          Panel.ZIndex="25"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=3}" />

        <!--  UserControl para Aba 4: Registo de Consultas/Sess├Áes  -->
        <abas:RegistoConsultasUserControl
          x:Name="RegistoConsultasUserControl"
          Panel.ZIndex="26"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=4}" />

        <!--  UserControl para Aba 5: Irisdiagn├│stico  -->
        <abas:IrisdiagnosticoUserControl
          x:Name="IrisdiagnosticoUserControl"
          Panel.ZIndex="22"
          Background="Transparent"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=5}" />

        <!--  UserControl para Aba 6: Comunicação  -->
        <abas:ComunicacaoUserControl
          x:Name="ComunicacaoUserControl"
          Panel.ZIndex="20"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=6}" />

        <!--  UserControl para Aba 7: Terapias  -->
        <abas:TerapiasUserControl
          x:Name="TerapiasUserControl"
          Panel.ZIndex="18"
          Background="Transparent"
          Visibility="{Binding AbaAtiva, Converter={StaticResource StringParameterToVisibilityConverter}, ConverterParameter=7}" />
      </Grid>

    </Border>

    <!--  === RODAP├ë DE NAVEGA├ç├âO ===  -->
    <Border
      Grid.Row="2"
      Padding="20,12"
      Background="{StaticResource CartaoBrush}"
      BorderBrush="{StaticResource BordaBrush}"
      BorderThickness="0,2,0,0">
      <Grid>
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*" />
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <!--  Bot├Áes Esquerda  -->
        <StackPanel
          Grid.Column="0"
          HorizontalAlignment="Left"
          Orientation="Horizontal">
          <Button
            Margin="0,0,12,0"
            Command="{Binding VoltarDashboardCommand}"
            Content="🏠 Home"
            Style="{StaticResource SecondaryButtonStyle}"
            ToolTip="Voltar ao Dashboard (protege alterações não guardadas)" />
          <Button
            Command="{Binding AbaAnteriorCommand}"
            Content="◀️ Anterior"
            Style="{StaticResource SecondaryButtonStyle}" />
        </StackPanel>

        <!--  Bot├Áes Centro - SISTEMA DE GRAVA├ç├âO MANUAL  -->
        <StackPanel
          Grid.Column="1"
          HorizontalAlignment="Center"
          Orientation="Horizontal">
          <Button
            Command="{Binding GuardarRascunhoCommand}"
            Content="💾 Guardar"
            Style="{StaticResource SecondaryButtonStyle}"
            ToolTip="Guardar paciente (Ctrl+S)" />
          <TextBlock
            Margin="12,0,0,0"
            VerticalAlignment="Center"
            FontSize="11"
            Foreground="{StaticResource TextoSecundario}"
            Text="{Binding StatusSave, FallbackValue='Pronto'}" />
        </StackPanel>

        <!--  Bot├Áes Direita  -->
        <StackPanel
          Grid.Column="2"
          HorizontalAlignment="Right"
          Orientation="Horizontal">
          <Button
            Command="{Binding ProximaAbaCommand}"
            Content="Seguinte ▶️"
            IsEnabled="{Binding PodeAvancarAba}"
            Style="{StaticResource NavigationButtonStyle}" />
        </StackPanel>
      </Grid>
    </Border>
  </Grid>
</UserControl>


