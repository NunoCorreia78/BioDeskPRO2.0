<UserControl
    x:Class="BioDesk.App.Views.Abas.ComunicacaoUserControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:BioDesk.App.Converters"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    xmlns:vm="clr-namespace:BioDesk.ViewModels.Abas;assembly=BioDesk.ViewModels"
    d:DataContext="{d:DesignInstance Type=vm:ComunicacaoViewModel}"
    d:DesignHeight="700"
    d:DesignWidth="1200"
    Background="Transparent"
    mc:Ignorable="d">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

        <!--  Conversor para inverter bool (IsLoading=true â†’ IsEnabled=false)  -->
        <local:InverseBooleanConverter x:Key="InverseBoolConverter" />
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />  
            <!--  Header  -->
            <RowDefinition Height="*" />    
            <!--  ConteÃºdo principal  -->
        </Grid.RowDefinitions>

        <!--  Header com status de conexÃ£o  -->
        <StackPanel
            Grid.Row="0"
            Margin="0,0,0,16"
            Orientation="Horizontal">
            <TextBlock
                VerticalAlignment="Center"
                FontSize="20"
                FontWeight="Bold"
                Foreground="#3F4A3D"
                Text="ðŸ“§ ComunicaÃ§Ã£o e Seguimento" />

            <!--  Indicador Online/Offline  -->
            <Border
                Margin="16,0,0,0"
                Padding="8,4"
                CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Background" Value="#4CAF50" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding TemConexao}" Value="False">
                                <Setter Property="Background" Value="#F44336" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock
                    FontSize="12"
                    FontWeight="SemiBold"
                    Foreground="White">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Text" Value="ðŸŸ¢ Online" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding TemConexao}" Value="False">
                                    <Setter Property="Text" Value="ðŸ”´ Offline" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </Border>

            <!--  Badge fila  -->
            <Border
                Margin="8,0"
                Padding="8,4"
                Background="#FFA726"
                CornerRadius="4">
                <Border.Style>
                    <Style TargetType="Border">
                        <Setter Property="Visibility" Value="Collapsed" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding MensagensNaFila}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding MensagensNaFila, Converter={x:Null}, FallbackValue=0}" Value="0">
                                <Setter Property="Visibility" Value="Collapsed" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </Border.Style>
                <TextBlock
                    FontSize="12"
                    FontWeight="SemiBold"
                    Foreground="White">
                    <Run Text="ðŸ“¬" />
                    <Run Text="{Binding MensagensNaFila, Mode=OneWay}" />
                    <Run Text="na fila" />
                </TextBlock>
            </Border>
        </StackPanel>

        <!--  ConteÃºdo principal: 2 Colunas  -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="450" />  
                <!--  Coluna Esquerda: Documentos + HistÃ³rico  -->
                <ColumnDefinition Width="*" />    
                <!--  Coluna Direita: FormulÃ¡rio Email  -->
            </Grid.ColumnDefinitions>

            <!--  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  -->
            <!--  COLUNA ESQUERDA: Documentos + HistÃ³rico  -->
            <!--  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  -->
            <ScrollViewer
                Grid.Column="0"
                Margin="0,0,12,0"
                VerticalScrollBarVisibility="Auto">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />  
                        <!--  Card Documentos  -->
                        <RowDefinition Height="12" />    
                        <!--  EspaÃ§amento  -->
                        <RowDefinition Height="Auto" />  
                        <!--  â­ HistÃ³rico com altura automÃ¡tica  -->
                    </Grid.RowDefinitions>

                    <!--  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  -->
                    <!--  ðŸ“ DOCUMENTOS DO PACIENTE  -->
                    <!--  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  -->
                    <Border
                        Grid.Row="0"
                        Padding="16"
                        Background="#F7F9F6"
                        CornerRadius="8">
                        <StackPanel>
                            <DockPanel Margin="0,0,0,12">
                                <TextBlock
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Left"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    Foreground="#3F4A3D"
                                    Text="ðŸ“ DOCUMENTOS DO PACIENTE" />

                                <Button
                                    Margin="8,0,0,0"
                                    Padding="6,4"
                                    VerticalAlignment="Center"
                                    Background="#9CAF97"
                                    BorderThickness="0"
                                    Command="{Binding CarregarDocumentosPacienteCommand}"
                                    Cursor="Hand"
                                    DockPanel.Dock="Right"
                                    Foreground="White">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            Margin="0,0,4,0"
                                            FontSize="12"
                                            Text="ðŸ”„" />
                                        <TextBlock FontSize="11" Text="Atualizar" />
                                    </StackPanel>
                                </Button>
                            </DockPanel>

                            <!--  Status Loading  -->
                            <Border
                                Margin="0,0,0,8"
                                Padding="8"
                                Background="#FFF3E0"
                                CornerRadius="4"
                                Visibility="{Binding CarregandoDocumentos, Converter={StaticResource BoolToVisibility}}">
                                <TextBlock
                                    FontSize="11"
                                    FontWeight="SemiBold"
                                    Foreground="#F57C00"
                                    Text="â³ A carregar documentos..."
                                    TextAlignment="Center" />
                            </Border>

                            <!--  Lista de Documentos  -->
                            <ListBox
                                MaxHeight="200"
                                Background="White"
                                BorderBrush="#E3E9DE"
                                BorderThickness="1"
                                ItemsSource="{Binding DocumentosPaciente}"
                                MouseDoubleClick="ListBoxDocumentos_MouseDoubleClick">
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="Padding" Value="8" />
                                        <Setter Property="Cursor" Value="Hand" />
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#F0F4EF" />
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Grid ToolTip="{Binding Tooltip, Mode=OneTime}">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <!--  Checkbox  -->
                                            <CheckBox
                                                Grid.Column="0"
                                                Margin="0,0,8,0"
                                                VerticalAlignment="Center"
                                                IsChecked="{Binding Selecionado}" />

                                            <!--  Info do documento  -->
                                            <StackPanel Grid.Column="1">
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock
                                                        Margin="0,0,4,0"
                                                        FontSize="12"
                                                        FontWeight="SemiBold"
                                                        Foreground="#3F4A3D"
                                                        Text="{Binding Icone, Mode=OneTime}" />
                                                    <TextBlock
                                                        FontSize="12"
                                                        FontWeight="SemiBold"
                                                        Foreground="#3F4A3D"
                                                        Text="{Binding NomeExibicao, Mode=OneTime}" />
                                                </StackPanel>
                                                <TextBlock
                                                    FontSize="10"
                                                    Foreground="#5A6558"
                                                    Text="{Binding DataFormatada, Mode=OneTime}" />
                                            </StackPanel>

                                            <!--  Tamanho  -->
                                            <TextBlock
                                                Grid.Column="2"
                                                Margin="8,0,0,0"
                                                VerticalAlignment="Center"
                                                FontSize="10"
                                                FontWeight="SemiBold"
                                                Foreground="#9CAF97"
                                                Text="{Binding TamanhoFormatado, Mode=OneTime}" />
                                        </Grid>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>

                            <!--  AÃ§Ãµes  -->
                            <StackPanel Margin="0,8,0,0" Orientation="Horizontal">
                                <Button
                                    Padding="10,6"
                                    Background="#4CAF50"
                                    BorderThickness="0"
                                    Command="{Binding AnexarDocumentosSelecionadosCommand}"
                                    Cursor="Hand"
                                    Foreground="White">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Margin="0,0,4,0" Text="ðŸ“Ž" />
                                        <TextBlock
                                            FontSize="12"
                                            FontWeight="SemiBold"
                                            Text="Anexar Selecionados" />
                                    </StackPanel>
                                </Button>

                                <Button
                                    Margin="8,0,0,0"
                                    Padding="8,6"
                                    Background="#9CAF97"
                                    BorderThickness="0"
                                    Command="{Binding SelecionarTodosDocumentosCommand}"
                                    CommandParameter="True"
                                    Cursor="Hand"
                                    Foreground="White">
                                    <TextBlock FontSize="11" Text="âœ“ Todos" />
                                </Button>

                                <Button
                                    Margin="4,0,0,0"
                                    Padding="8,6"
                                    Background="#CFD8CA"
                                    BorderThickness="0"
                                    Command="{Binding SelecionarTodosDocumentosCommand}"
                                    CommandParameter="False"
                                    Cursor="Hand"
                                    Foreground="#5A6558">
                                    <TextBlock FontSize="11" Text="âŠ— Limpar" />
                                </Button>
                            </StackPanel>

                            <!--  Status  -->
                            <TextBlock
                                Margin="0,8,0,0"
                                FontSize="11"
                                FontStyle="Italic"
                                Foreground="#5A6558"
                                Text="{Binding StatusDocumentos}"
                                TextAlignment="Center" />
                        </StackPanel>
                    </Border>

                    <!--  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  -->
                    <!--  ðŸ“œ HISTÃ“RICO DE COMUNICAÃ‡Ã•ES  -->
                    <!--  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  -->
                    <Border
                        Grid.Row="2"
                        Padding="16"
                        Background="#F7F9F6"
                        BorderBrush="#E3E9DE"
                        BorderThickness="1"
                        CornerRadius="8">
                        <StackPanel>
                            <!--  Header com tÃ­tulo e informaÃ§Ã£o Ãºtil  -->
                            <DockPanel Margin="0,0,0,10">
                                <StackPanel
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Left"
                                    Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,6,0"
                                        FontSize="14"
                                        Text="ðŸ“œ" />
                                    <TextBlock
                                        FontSize="13"
                                        FontWeight="SemiBold"
                                        Foreground="#3F4A3D"
                                        Text="HistÃ³rico" />
                                </StackPanel>

                                <!--  InformaÃ§Ã£o Ãºtil no canto direito  -->
                                <StackPanel
                                    HorizontalAlignment="Right"
                                    DockPanel.Dock="Right"
                                    Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,4,0"
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Text="ðŸ“¤" />
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Foreground="#5A6558">
                                        <Run Text="{Binding TotalEnviados, Mode=OneWay}" />
                                        <Run Text="enviados" />
                                    </TextBlock>
                                    <TextBlock
                                        Margin="8,0,8,0"
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Foreground="#5A6558"
                                        Text="â€¢" />
                                    <TextBlock
                                        Margin="0,0,4,0"
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Text="â°" />
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="11"
                                        Foreground="#5A6558"
                                        Text="{Binding ProximoAgendamento, Mode=OneWay}" />
                                </StackPanel>
                            </DockPanel>

                            <!--  DataGrid do HistÃ³rico  -->
                            <DataGrid
                                AlternatingRowBackground="#F0F4EF"
                                AutoGenerateColumns="False"
                                Background="Transparent"
                                BorderThickness="0"
                                CanUserAddRows="False"
                                GridLinesVisibility="None"
                                HeadersVisibility="Column"
                                IsReadOnly="True"
                                ItemsSource="{Binding HistoricoComunicacoes}"
                                RowBackground="White">
                                <DataGrid.Columns>
                                    <DataGridTextColumn
                                        Width="90"
                                        Binding="{Binding DataCriacao, StringFormat='{}{0:dd/MM HH:mm}'}"
                                        Header="Data" />
                                    <DataGridTextColumn
                                        Width="60"
                                        Binding="{Binding Tipo}"
                                        Header="Tipo" />
                                    <DataGridTextColumn
                                        Width="*"
                                        Binding="{Binding Assunto}"
                                        Header="Assunto" />
                                    <DataGridTextColumn
                                        Width="80"
                                        Binding="{Binding Status}"
                                        Header="Status" />

                                    <!--  AÃ§Ãµes (Cancelar para emails Agendados)  -->
                                    <DataGridTemplateColumn Width="70" Header="AÃ§Ãµes">
                                        <DataGridTemplateColumn.CellTemplate>
                                            <DataTemplate>
                                                <Button
                                                    Padding="4,2"
                                                    Background="#F44336"
                                                    BorderThickness="0"
                                                    Command="{Binding DataContext.CancelarEmailCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand"
                                                    FontSize="9"
                                                    Foreground="White">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Visibility" Value="Collapsed" />
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="2">
                                                                    <Setter Property="Visibility" Value="Visible" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                    <TextBlock Text="Cancelar" />
                                                </Button>
                                            </DataTemplate>
                                        </DataGridTemplateColumn.CellTemplate>
                                    </DataGridTemplateColumn>
                                </DataGrid.Columns>
                            </DataGrid>
                        </StackPanel>
                    </Border>
                </Grid>
            </ScrollViewer>

            <!--  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  -->
            <!--  COLUNA DIREITA: FormulÃ¡rio de Email  -->
            <!--  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  -->
            <Border
                Grid.Column="1"
                Padding="20"
                Background="#F7F9F6"
                CornerRadius="8">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock
                            Margin="0,0,0,16"
                            FontSize="18"
                            FontWeight="SemiBold"
                            Foreground="#3F4A3D"
                            Text="âœ‰ï¸ Enviar Email" />

                        <!--  Para  -->
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="#5A6558"
                            Text="Para:" />
                        <TextBox
                            Margin="0,0,0,16"
                            Padding="10"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            FontSize="13"
                            Text="{Binding Destinatario, UpdateSourceTrigger=PropertyChanged}" />

                        <!--  Template  -->
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="#5A6558"
                            Text="Template:" />
                        <ComboBox
                            Margin="0,0,0,16"
                            Padding="10"
                            FontSize="13"
                            ItemsSource="{Binding Templates}"
                            SelectedItem="{Binding TemplateSelecionado}"
                            ToolTip="Escolha um template prÃ©-definido ou 'Personalizado' para escrever livremente" />

                        <!--  Assunto  -->
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="#5A6558"
                            Text="Assunto:" />
                        <TextBox
                            Margin="0,0,0,16"
                            Padding="10"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            FontSize="13"
                            Text="{Binding Assunto, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Escreva um assunto claro e profissional" />

                        <!--  Corpo  -->
                        <TextBlock
                            Margin="0,0,0,6"
                            FontSize="13"
                            FontWeight="SemiBold"
                            Foreground="#5A6558"
                            Text="Mensagem:" />
                        <TextBox
                            Height="240"
                            Margin="0,0,0,16"
                            Padding="10"
                            AcceptsReturn="True"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            FontSize="13"
                            Text="{Binding Corpo, UpdateSourceTrigger=PropertyChanged}"
                            TextWrapping="Wrap"
                            ToolTip="Corpo do email. Pode usar mÃºltiplas linhas com Enter"
                            VerticalScrollBarVisibility="Auto" />

                        <!--  Anexos  -->
                        <StackPanel Margin="0,0,0,16">
                            <DockPanel Margin="0,0,0,10">
                                <TextBlock
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Left"
                                    FontSize="13"
                                    FontWeight="SemiBold"
                                    Foreground="#5A6558"
                                    Text="ðŸ“Ž Anexos:" />
                                <Button
                                    Margin="12,0,0,0"
                                    Padding="10,6"
                                    Background="#9CAF97"
                                    BorderThickness="0"
                                    Command="{Binding AdicionarAnexoCommand}"
                                    Cursor="Hand"
                                    DockPanel.Dock="Left"
                                    Foreground="White"
                                    ToolTip="Anexar ficheiros do computador (documentos, imagens, PDFs)">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Margin="0,0,4,0" Text="ðŸ“Ž" />
                                        <TextBlock FontSize="12" Text="Anexar Ficheiro" />
                                    </StackPanel>
                                </Button>

                                <!--  â­ NOVO: BotÃ£o Selecionar Templates  -->
                                <Button
                                    Margin="8,0,0,0"
                                    Padding="10,6"
                                    Background="#879B83"
                                    BorderThickness="0"
                                    Click="BtnSelecionarTemplates_Click"
                                    Cursor="Hand"
                                    DockPanel.Dock="Left"
                                    Foreground="White"
                                    ToolTip="Selecionar templates PDF da pasta Templates/PDFs/ para anexar">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Margin="0,0,4,0" Text="ðŸ“‹" />
                                        <TextBlock FontSize="12" Text="Selecionar Templates" />
                                    </StackPanel>
                                </Button>

                                <!--  â­ REMOVIDO: BotÃ£o deve estar nas ConfiguraÃ§Ãµes, nÃ£o na ficha do paciente  -->
                                <!--
                                <Button Command="{Binding AdicionarNovoTemplatePdfCommand}"
                                        Background="#7A8C73"
                                        Foreground="White"
                                        Padding="10,6"
                                        Margin="8,0,0,0"
                                        Cursor="Hand"
                                        BorderThickness="0"
                                        DockPanel.Dock="Left"
                                        ToolTip="Copiar novo ficheiro PDF para a pasta Templates/PDFs/ para uso futuro">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="âž•" Margin="0,0,4,0"/>
                                        <TextBlock Text="Adicionar Template" FontSize="12"/>
                                    </StackPanel>
                                </Button>
                                -->

                                <TextBlock
                                    Margin="12,0,0,0"
                                    VerticalAlignment="Center"
                                    DockPanel.Dock="Left"
                                    FontSize="11"
                                    Foreground="#5A6558"
                                    Text="{Binding StatusAnexos}" />
                            </DockPanel>

                            <!--  Lista de anexos  -->
                            <ItemsControl ItemsSource="{Binding Anexos}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                            Margin="0,0,0,6"
                                            Padding="8,6"
                                            Background="White"
                                            BorderBrush="#E3E9DE"
                                            BorderThickness="1"
                                            CornerRadius="4">
                                            <DockPanel>
                                                <Button
                                                    Padding="4"
                                                    Background="Transparent"
                                                    BorderThickness="0"
                                                    Command="{Binding DataContext.RemoverAnexoCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    CommandParameter="{Binding}"
                                                    Cursor="Hand"
                                                    DockPanel.Dock="Right"
                                                    Foreground="#F44336">
                                                    <TextBlock FontSize="12" Text="âŒ" />
                                                </Button>
                                                <TextBlock
                                                    VerticalAlignment="Center"
                                                    FontSize="12"
                                                    Foreground="#3F4A3D"
                                                    Text="{Binding}"
                                                    TextTrimming="CharacterEllipsis"
                                                    ToolTip="{Binding}" />
                                            </DockPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>

                        <!--  â­ AGENDAMENTO DE ENVIO: Enviar agora ou agendar para data futura  -->
                        <CheckBox
                            Margin="0,0,0,10"
                            Content="ðŸ“… Agendar envio para data futura"
                            FontSize="12"
                            FontWeight="SemiBold"
                            Foreground="#FF9800"
                            IsChecked="{Binding AgendarEnvio}" />

                        <StackPanel Margin="20,0,0,20" Visibility="{Binding AgendarEnvio, Converter={StaticResource BoolToVisibility}}">
                            <TextBlock
                                Margin="0,0,0,6"
                                FontSize="11"
                                Foreground="#5A6558"
                                Text="Data e hora de envio:" />
                            <DatePicker
                                Width="200"
                                Margin="0,0,0,8"
                                HorizontalAlignment="Left"
                                FontSize="12"
                                SelectedDate="{Binding DataEnvioAgendado}"
                                ToolTip="Escolha a data futura para envio automÃ¡tico do email" />
                            <TextBlock
                                FontSize="10"
                                FontStyle="Italic"
                                Foreground="#FF9800"
                                Text="âš ï¸ O email serÃ¡ enviado automaticamente na data escolhida" />
                        </StackPanel>

                        <!--  BotÃ£o Enviar  -->
                        <Button
                            Padding="16,12"
                            Background="#9CAF97"
                            BorderThickness="0"
                            Command="{Binding EnviarEmailCommand}"
                            Cursor="Hand"
                            Foreground="White"
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            ToolTip="Ctrl+Enter para enviar rapidamente">
                            <StackPanel Orientation="Horizontal">
                                <!--  Loading State: Mostra spinner se IsLoading=true  -->
                                <TextBlock Margin="0,0,8,0" FontSize="16">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="ðŸ“¤" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                                    <Setter Property="Text" Value="â³" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                                <TextBlock FontSize="14" FontWeight="SemiBold">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Enviar Email" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsLoading}" Value="True">
                                                    <Setter Property="Text" Value="A enviar..." />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</UserControl>
