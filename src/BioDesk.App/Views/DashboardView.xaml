<UserControl x:Class="BioDesk.App.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:oxy="http://oxyplot.org/wpf">

    <UserControl.Resources>
        <ResourceDictionary>
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
            <Style x:Key="StatCard" TargetType="Border">
                <Setter Property="Background" Value="#F7F9F6"/>
                <Setter Property="BorderBrush" Value="#E3E9DE"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="CornerRadius" Value="8"/>
                <Setter Property="Padding" Value="20,15"/>
                <Setter Property="Margin" Value="0,0,0,15"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="#879B83"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
            
            <Style x:Key="ModernTabItem" TargetType="TabItem">
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TabItem">
                            <Grid>
                                <Border Name="Border" Background="#F7F9F6" BorderBrush="#E3E9DE" 
                                        BorderThickness="1,1,1,0" CornerRadius="8,8,0,0" 
                                        Margin="2,0,2,0" Padding="12,8">
                                    <ContentPresenter ContentSource="Header"/>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#9CAF97"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Border" Property="Background" Value="#879B83"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Navigation Cards Row -->
        <Grid Grid.Row="0" Margin="20,20,20,20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Novo Paciente Card -->
            <Border Grid.Column="0" Style="{StaticResource StatCard}" Margin="0,0,10,0"
                    Background="#9CAF97" BorderBrush="#879B83" Cursor="Hand">
                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding NovoPacienteCommand}"/>
                </Border.InputBindings>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="âž•" FontSize="32" HorizontalAlignment="Center" Foreground="White" Margin="0,0,0,8"/>
                    <TextBlock Text="Novo Paciente" FontWeight="SemiBold" FontSize="16" HorizontalAlignment="Center" Foreground="White"/>
                </StackPanel>
            </Border>

            <!-- Lista Pacientes Card -->
            <Border Grid.Column="1" Style="{StaticResource StatCard}" Margin="10,0,0,0"
                    Background="#9CAF97" BorderBrush="#879B83" Cursor="Hand">
                <Border.InputBindings>
                    <MouseBinding MouseAction="LeftClick" Command="{Binding AbrirListaPacientesCommand}"/>
                </Border.InputBindings>
                <StackPanel HorizontalAlignment="Center">
                    <TextBlock Text="ðŸ“‹" FontSize="32" HorizontalAlignment="Center" Foreground="White" Margin="0,0,0,8"/>
                    <TextBlock Text="Lista Pacientes" FontWeight="SemiBold" FontSize="16" HorizontalAlignment="Center" Foreground="White"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Main TabControl -->
        <TabControl Grid.Row="1" 
                    Background="Transparent"
                    BorderThickness="0"
                    SelectedIndex="{Binding SelectedTabIndex}"
                    Margin="20,0,20,20">

            <!-- Activity Tab (FIRST - with statistics cards) -->
            <TabItem Header="âš¡ Atividade Recente" Style="{StaticResource ModernTabItem}">
                <Border Background="#F7F9F6" BorderBrush="#E3E9DE" BorderThickness="1" CornerRadius="0,8,8,8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                        <StackPanel>
                            <!-- Statistics Cards (general stats only) -->
                            <TextBlock Text="EstatÃ­sticas do Sistema" FontSize="20" FontWeight="SemiBold" Foreground="#3F4A3D" Margin="0,0,0,20"/>
                            
                            <Grid Margin="0,0,0,30">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Total Pacientes Card -->
                                <Border Grid.Column="0" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Total Pacientes" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding TotalPacientes}" FontSize="24" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Pacientes Hoje Card -->
                                <Border Grid.Column="1" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Registros Hoje" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding PacientesHoje}" FontSize="24" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Emails Card -->
                                <Border Grid.Column="2" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Emails Hoje" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding EmailStats.EmailsHoje}" FontSize="24" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Pendentes Card -->
                                <Border Grid.Column="3" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Emails Pendentes" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding EmailStats.EmailsPendentes}" FontSize="24" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- Activity Content -->
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="20"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Pacientes Recentes -->
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Pacientes Recentes" FontSize="18" FontWeight="SemiBold" Foreground="#3F4A3D" Margin="0,0,0,15"/>
                                    
                                    <ItemsControl ItemsSource="{Binding PacientesRecentes}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource StatCard}" Margin="0,0,0,10">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <StackPanel Grid.Column="0">
                                                            <TextBlock Text="{Binding Nome}" FontWeight="SemiBold" FontSize="14" Foreground="#3F4A3D"/>
                                                            <TextBlock Text="{Binding Email}" FontSize="12" Foreground="#5A6558"/>
                                                            <TextBlock Text="{Binding TempoRelativo}" FontSize="11" Foreground="#879B83"/>
                                                        </StackPanel>
                                                        
                                                        <TextBlock Grid.Column="1" Text="ðŸ‘¤" FontSize="16" VerticalAlignment="Center"/>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>

                                <!-- Atividade do Sistema -->
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Atividade do Sistema" FontSize="18" FontWeight="SemiBold" Foreground="#3F4A3D" Margin="0,0,0,15"/>
                                    
                                    <ItemsControl ItemsSource="{Binding AtividadeRecente}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Border Style="{StaticResource StatCard}" Margin="0,0,0,10">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto"/>
                                                            <ColumnDefinition Width="*"/>
                                                        </Grid.ColumnDefinitions>
                                                        
                                                        <TextBlock Grid.Column="0" Text="{Binding Icone}" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Top"/>
                                                        
                                                        <StackPanel Grid.Column="1">
                                                            <TextBlock Text="{Binding Descricao}" FontWeight="SemiBold" FontSize="13" Foreground="#3F4A3D" TextWrapping="Wrap"/>
                                                            <TextBlock Text="{Binding TempoRelativo}" FontSize="11" Foreground="#879B83"/>
                                                        </StackPanel>
                                                    </Grid>
                                                </Border>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>

            <!-- Charts Tab -->
            <TabItem Header="ðŸ“ˆ GrÃ¡ficos" Style="{StaticResource ModernTabItem}">
                <Border Background="#F7F9F6" BorderBrush="#E3E9DE" BorderThickness="1" CornerRadius="0,8,8,8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                        <StackPanel>
                            <TextBlock Text="AnÃ¡lise GrÃ¡fica" FontSize="20" FontWeight="SemiBold" Foreground="#3F4A3D" Margin="0,0,0,20"/>
                            
                            <!-- Charts Grid -->
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="300"/>
                                    <RowDefinition Height="20"/>
                                    <RowDefinition Height="300"/>
                                    <RowDefinition Height="20"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="300"/>
                                    <RowDefinition Height="20"/>
                                    <RowDefinition Height="300"/>
                                </Grid.RowDefinitions>

                                <!-- Registros por Dia -->
                                <Border Grid.Row="0" Style="{StaticResource StatCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" Text="Registros por Dia (Ãšltimos 7 dias)" 
                                                   FontSize="16" FontWeight="SemiBold" 
                                                   Foreground="#3F4A3D" 
                                                   Margin="0,0,0,10"/>
                                        
                                        <oxy:PlotView Grid.Row="1" 
                                                      Model="{Binding GraficoRegistrosPorDia}"
                                                      Background="Transparent"/>
                                    </Grid>
                                </Border>

                                <!-- EvoluÃ§Ã£o Mensal -->
                                <Border Grid.Row="2" Style="{StaticResource StatCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" Text="EvoluÃ§Ã£o Mensal" 
                                                   FontSize="16" FontWeight="SemiBold" 
                                                   Foreground="#3F4A3D" 
                                                   Margin="0,0,0,10"/>
                                        
                                        <oxy:PlotView Grid.Row="1" 
                                                      Model="{Binding GraficoEvolucaoMensal}"
                                                      Background="Transparent"/>
                                    </Grid>
                                </Border>

                                <!-- Separador Consultas -->
                                <TextBlock Grid.Row="4" Text="ðŸ“… EstatÃ­sticas de Consultas" 
                                           FontSize="18" FontWeight="SemiBold" 
                                           Foreground="#9CAF97" 
                                           Margin="0,20,0,20" HorizontalAlignment="Center"/>

                                <!-- Consultas por Semana -->
                                <Border Grid.Row="5" Style="{StaticResource StatCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" Text="Consultas Realizadas por Semana (Ãšltimas 8 Semanas)" 
                                                   FontSize="16" FontWeight="SemiBold" 
                                                   Foreground="#3F4A3D" 
                                                   Margin="0,0,0,10"/>
                                        
                                        <oxy:PlotView Grid.Row="1" 
                                                      Model="{Binding ConsultasPorSemanaChart}"
                                                      Background="Transparent"/>
                                    </Grid>
                                </Border>

                                <!-- Tipos de Consulta -->
                                <Border Grid.Row="7" Style="{StaticResource StatCard}">
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" Text="DistribuiÃ§Ã£o por Tipo de Consulta" 
                                                   FontSize="16" FontWeight="SemiBold" 
                                                   Foreground="#3F4A3D" 
                                                   Margin="0,0,0,10"/>
                                        
                                        <oxy:PlotView Grid.Row="1" 
                                                      Model="{Binding TiposConsultaChart}"
                                                      Background="Transparent"/>
                                    </Grid>
                                </Border>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>

            <!-- Statistics Tab -->
            <TabItem Header="ðŸ“Š EstatÃ­sticas" Style="{StaticResource ModernTabItem}">
                <Border Background="#F7F9F6" BorderBrush="#E3E9DE" BorderThickness="1" CornerRadius="0,8,8,8">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                        <StackPanel>
                            <TextBlock Text="Resumo EstatÃ­stico Detalhado" FontSize="20" FontWeight="SemiBold" Foreground="#3F4A3D" Margin="0,0,0,20"/>
                            
                            <!-- EstatÃ­sticas de Pacientes -->
                            <TextBlock Text="ðŸ‘¥ Pacientes" FontSize="16" FontWeight="SemiBold" Foreground="#9CAF97" Margin="0,0,0,15"/>
                            <Grid Margin="0,0,0,30">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Registros por Semana -->
                                <Border Grid.Column="0" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Esta Semana" FontWeight="SemiBold" Foreground="#5A6558" FontSize="16" Margin="0,0,0,10"/>
                                        <TextBlock Text="{Binding PacientesSemana}" FontSize="32" FontWeight="Bold" Foreground="#9CAF97"/>
                                        <TextBlock Text="novos registros" FontSize="12" Foreground="#5A6558"/>
                                    </StackPanel>
                                </Border>

                                <!-- Registros por MÃªs -->
                                <Border Grid.Column="1" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Este MÃªs" FontWeight="SemiBold" Foreground="#5A6558" FontSize="16" Margin="0,0,0,10"/>
                                        <TextBlock Text="{Binding PacientesMes}" FontSize="32" FontWeight="Bold" Foreground="#9CAF97"/>
                                        <TextBlock Text="novos registros" FontSize="12" Foreground="#5A6558"/>
                                    </StackPanel>
                                </Border>
                            </Grid>

                            <!-- EstatÃ­sticas de Consultas -->
                            <TextBlock Text="ðŸ“… Consultas" FontSize="16" FontWeight="SemiBold" Foreground="#9CAF97" Margin="0,25,0,15"/>
                            <Grid Margin="0,0,0,20">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="10"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Total Consultas Card -->
                                <Border Grid.Column="0" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Total Consultas" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding ConsultaStats.TotalConsultas}" FontSize="24" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Consultas Esta Semana Card -->
                                <Border Grid.Column="2" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Esta Semana" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding ConsultaStats.ConsultasEstaSemana}" FontSize="24" FontWeight="Bold" Foreground="#9CAF97" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Primeiras Consultas Card -->
                                <Border Grid.Column="4" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Primeiras Consultas" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding ConsultaStats.PrimeirasConsultas}" FontSize="24" FontWeight="Bold" Foreground="#879B83" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- Valor Semana Card -->
                                <Border Grid.Column="6" Style="{StaticResource StatCard}">
                                    <StackPanel>
                                        <TextBlock Text="Valor Esta Semana" FontWeight="SemiBold" Foreground="#5A6558" FontSize="14"/>
                                        <TextBlock Text="{Binding ConsultaStats.ValorTotalSemana, StringFormat='{}{0:C}'}" FontSize="20" FontWeight="Bold" Foreground="#3F4A3D" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </TabItem>
        </TabControl>

        <!-- Loading Overlay -->
        <Border Grid.RowSpan="2" 
                Background="#80FFFFFF" 
                Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <ProgressBar IsIndeterminate="True" Width="200" Height="8" 
                           Foreground="#9CAF97" Background="#E3E9DE"/>
                <TextBlock Text="A carregar dashboard..." 
                         FontSize="14" Foreground="#5A6558" 
                         HorizontalAlignment="Center" 
                         Margin="0,10,0,0"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>
