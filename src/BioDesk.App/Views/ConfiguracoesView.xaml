<Window
    x:Class="BioDesk.App.Views.ConfiguracoesView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="âš™ï¸ ConfiguraÃ§Ãµes - BioDeskPro"
    Width="700"
    Height="500"
    Background="{StaticResource FundoPrincipal}"
    ResizeMode="NoResize"
    WindowStartupLocation="CenterOwner"
    mc:Ignorable="d">

    <Window.Resources>
        <!--  Converter para Visibility  -->
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />

    </Window.Resources>

    <Grid Margin="30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  CabeÃ§alho  -->
        <StackPanel Grid.Row="0" Margin="0,0,0,25">
            <TextBlock
                FontSize="24"
                FontWeight="SemiBold"
                Foreground="{StaticResource TextoPrincipal}"
                Text="âš™ï¸ ConfiguraÃ§Ãµes do Sistema" />
            <TextBlock
                Margin="0,5,0,0"
                FontSize="13"
                Foreground="{StaticResource TextoSecundario}"
                Text="Gerir credenciais de email e outras configuraÃ§Ãµes" />
        </StackPanel>

        <!--  ConteÃºdo Principal com TabControl  -->
        <TabControl
            Grid.Row="1"
            Margin="0,0,0,15"
            TabStripPlacement="Left">
            <TabControl.Resources>
                <Style TargetType="TabItem">
                    <Setter Property="HeaderTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <TextBlock
                                    Padding="20,15"
                                    FontSize="14"
                                    Text="{Binding}" />
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Background" Value="Transparent" />
                    <Setter Property="BorderBrush" Value="#E3E9DE" />
                    <Setter Property="BorderThickness" Value="0,0,1,0" />
                    <Style.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="#9CAF97" />
                            <Setter Property="Foreground" Value="White" />
                            <Setter Property="FontWeight" Value="SemiBold" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </TabControl.Resources>

            <!--  TAB 1: EMAIL  -->
            <TabItem Header="ðŸ“§ Email">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="30">
                        <Border
                            Padding="25"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            CornerRadius="12">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,20" Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,10,0"
                                        FontSize="20"
                                        Text="ðŸ“§" />
                                    <TextBlock
                                        VerticalAlignment="Center"
                                        FontSize="18"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource TextoPrincipal}"
                                        Text="ConfiguraÃ§Ãµes de Email" />
                                </StackPanel>

                                <StackPanel Margin="0,0,0,15">
                                    <TextBlock Style="{StaticResource FieldLabelStyle}" Text="Email de Envio *" />
                                    <TextBox
                                        Style="{StaticResource FieldTextBoxStyle}"
                                        Tag="exemplo@gmail.com"
                                        Text="{Binding EmailRemetente, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBlock
                                        Margin="0,4,0,0"
                                        FontSize="10"
                                        Foreground="{StaticResource TextoSecundario}"
                                        Text="Email da conta Gmail que enviarÃ¡ as comunicaÃ§Ãµes" />
                                </StackPanel>

                                <StackPanel Margin="0,0,0,15">
                                    <TextBlock Style="{StaticResource FieldLabelStyle}" Text="App Password do Gmail *" />
                                    <PasswordBox
                                        x:Name="PasswordBox"
                                        PasswordChanged="PasswordBox_PasswordChanged"
                                        Style="{StaticResource FieldPasswordBoxStyle}" />
                                    <TextBlock
                                        Margin="0,4,0,0"
                                        FontSize="10"
                                        Foreground="#D97706"
                                        Text="âš ï¸ Use uma App Password, nÃ£o a senha normal da conta" />
                                </StackPanel>

                                <StackPanel Margin="0,0,0,20">
                                    <TextBlock Style="{StaticResource FieldLabelStyle}" Text="Nome do Remetente" />
                                    <TextBox
                                        Style="{StaticResource FieldTextBoxStyle}"
                                        Tag="ClÃ­nica de Terapias Naturais"
                                        Text="{Binding NomeRemetente, UpdateSourceTrigger=PropertyChanged}" />
                                    <TextBlock
                                        Margin="0,4,0,0"
                                        FontSize="10"
                                        Foreground="{StaticResource TextoSecundario}"
                                        Text="Nome que aparecerÃ¡ nos emails enviados" />
                                </StackPanel>

                                <Border
                                    Padding="15"
                                    Background="#FEF3C7"
                                    BorderBrush="#FCD34D"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                    <StackPanel>
                                        <StackPanel Margin="0,0,0,10" Orientation="Horizontal">
                                            <TextBlock
                                                Margin="0,0,8,0"
                                                FontSize="16"
                                                Text="ðŸ”" />
                                            <TextBlock
                                                FontSize="13"
                                                FontWeight="SemiBold"
                                                Foreground="#92400E"
                                                Text="Como Obter uma App Password do Gmail" />
                                        </StackPanel>
                                        <TextBlock
                                            FontSize="11"
                                            Foreground="#92400E"
                                            LineHeight="18"
                                            TextWrapping="Wrap">
                                            <Run Text="1. Aceda a:" />
                                            <Run FontWeight="SemiBold" Text="https://myaccount.google.com/apppasswords" />
                                            <LineBreak />
                                            <Run Text="2. FaÃ§a login na sua conta Gmail" />
                                            <LineBreak />
                                            <Run Text="3. Clique em 'Criar' e escolha um nome (ex: BioDeskPro)" />
                                            <LineBreak />
                                            <Run Text="4. Copie a password gerada (16 caracteres) e cole aqui" />
                                            <LineBreak />
                                            <LineBreak />
                                            <Run FontWeight="SemiBold" Text="âš ï¸ Esta password Ã© diferente da senha normal da sua conta e Ã© mais segura!" />
                                        </TextBlock>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!--  TAB 2: DOCUMENTOS & TEMPLATES  -->
            <TabItem Header="ï¿½ Documentos">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="30">
                        <TextBlock
                            Margin="0,0,0,10"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextoPrincipal}"
                            Text="ï¿½ GestÃ£o de Documentos e Templates" />

                        <TextBlock
                            Margin="0,0,0,30"
                            FontSize="13"
                            Foreground="{StaticResource TextoSecundario}"
                            Text="Templates globais e documentos da clÃ­nica (regulamentos, formulÃ¡rios, logos)" />

                        <!--  SecÃ§Ã£o Templates PDF  -->
                        <Border
                            Margin="0,0,0,20"
                            Padding="25"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            CornerRadius="12">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,10,0"
                                        FontSize="18"
                                        Text="ðŸ“„" />
                                    <TextBlock
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource TextoPrincipal}"
                                        Text="Templates PDF para PrescriÃ§Ãµes" />
                                </StackPanel>

                                <TextBlock
                                    Margin="0,0,0,15"
                                    FontSize="12"
                                    Foreground="{StaticResource TextoSecundario}"
                                    Text="Ficheiros PDF usados como base para prescriÃ§Ãµes naturopÃ¡ticas"
                                    TextWrapping="Wrap" />

                                <Button
                                    Padding="15,10"
                                    HorizontalAlignment="Left"
                                    Background="#9CAF97"
                                    BorderBrush="#879B83"
                                    BorderThickness="0"
                                    Command="{Binding AdicionarNovoTemplatePdfCommand}"
                                    Foreground="White"
                                    ToolTip="Copiar ficheiro PDF para a pasta Templates">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            Margin="0,0,8,0"
                                            FontSize="16"
                                            Text="âž•" />
                                        <TextBlock FontSize="14" Text="Adicionar Template PDF" />
                                    </StackPanel>
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Cursor" Value="Hand" />
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#879B83" />
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>

                                <Border
                                    Margin="0,15,0,0"
                                    Padding="15"
                                    Background="#F7F9F6"
                                    BorderBrush="#E3E9DE"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                    <StackPanel>
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontWeight="SemiBold"
                                            Text="ðŸ“‚ Templates Encontrados:" />
                                        <TextBlock
                                            FontSize="12"
                                            FontStyle="Italic"
                                            Foreground="#999"
                                            Text="(Lista de templates serÃ¡ implementada em versÃ£o futura)" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <!--  SecÃ§Ã£o Logos e Assinaturas  -->
                        <Border
                            Padding="25"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            CornerRadius="12">
                            <StackPanel>
                                <StackPanel Margin="0,0,0,15" Orientation="Horizontal">
                                    <TextBlock
                                        Margin="0,0,10,0"
                                        FontSize="18"
                                        Text="ðŸ–¼ï¸" />
                                    <TextBlock
                                        FontSize="16"
                                        FontWeight="SemiBold"
                                        Foreground="{StaticResource TextoPrincipal}"
                                        Text="Logos e Assinaturas" />
                                </StackPanel>

                                <TextBlock
                                    Margin="0,0,0,15"
                                    FontSize="12"
                                    Foreground="{StaticResource TextoSecundario}"
                                    Text="Imagens usadas em cabeÃ§alhos de documentos (geridas na aba 'Dados da ClÃ­nica')"
                                    TextWrapping="Wrap" />

                                <Border
                                    Padding="12"
                                    Background="#FEF3C7"
                                    BorderBrush="#FCD34D"
                                    BorderThickness="1"
                                    CornerRadius="8">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock
                                            Margin="0,0,8,0"
                                            FontSize="14"
                                            Text="â„¹ï¸" />
                                        <TextBlock
                                            FontSize="11"
                                            Foreground="#92400E"
                                            Text="ConfiguraÃ§Ã£o de logo disponÃ­vel em Dashboard â†’ ConfiguraÃ§Ãµes da ClÃ­nica"
                                            TextWrapping="Wrap" />
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!--  TAB 3: PREFERÃŠNCIAS  -->
            <TabItem Header="ðŸŽ¨ PreferÃªncias">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="30">
                        <TextBlock
                            Margin="0,0,0,20"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextoPrincipal}"
                            Text="ðŸŽ¨ PreferÃªncias do Sistema" />
                        <TextBlock
                            FontStyle="Italic"
                            Foreground="#999"
                            Text="(Funcionalidades futuras: Temas, Idioma, Formato de Data)" />
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!--  TAB 4: SISTEMA  -->
            <TabItem Header="ðŸ”§ Sistema">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="30">
                        <TextBlock
                            Margin="0,0,0,20"
                            FontSize="20"
                            FontWeight="SemiBold"
                            Foreground="{StaticResource TextoPrincipal}"
                            Text="ðŸ”§ InformaÃ§Ãµes do Sistema" />

                        <Border
                            Margin="0,0,0,15"
                            Padding="20"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            CornerRadius="8">
                            <StackPanel>
                                <TextBlock
                                    Margin="0,0,0,10"
                                    FontWeight="SemiBold"
                                    Text="ðŸ’» VersÃ£o" />
                                <TextBlock FontSize="14" Text="BioDeskPro2 v1.0.0" />
                                <TextBlock
                                    Margin="0,5,0,0"
                                    FontSize="12"
                                    Foreground="#999"
                                    Text=".NET 8.0 | WPF | SQLite" />
                            </StackPanel>
                        </Border>

                        <Border
                            Padding="20"
                            Background="White"
                            BorderBrush="#E3E9DE"
                            BorderThickness="1"
                            CornerRadius="8">
                            <StackPanel>
                                <TextBlock
                                    Margin="0,0,0,10"
                                    FontWeight="SemiBold"
                                    Text="ðŸ’¾ Base de Dados" />
                                <TextBlock FontSize="14" Text="biodesk.db (SQLite)" />
                                <Button
                                    Margin="0,10,0,0"
                                    Padding="10,5"
                                    HorizontalAlignment="Left"
                                    Content="ðŸ“‚ Abrir Pasta"
                                    ToolTip="Abrir pasta com ficheiro da base de dados" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!--  RodapÃ© com BotÃµes  -->
        <Border
            Grid.Row="2"
            Padding="0,20,0,0"
            BorderBrush="#E3E9DE"
            BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!--  BotÃ£o Cancelar  -->
                <Button
                    Grid.Column="0"
                    Padding="20,12"
                    HorizontalAlignment="Left"
                    Click="BtnCancelar_Click"
                    Content="âœ–ï¸ Cancelar"
                    Style="{StaticResource SecondaryButtonStyle}" />

                <!--  BotÃµes Direita  -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button
                        Margin="0,0,10,0"
                        Padding="20,12"
                        Command="{Binding TestarConexaoCommand}"
                        Content="ðŸ§ª Testar ConexÃ£o"
                        Style="{StaticResource SecondaryButtonStyle}"
                        ToolTip="Envia um email de teste para verificar configuraÃ§Ã£o" />
                    <Button
                        Padding="20,12"
                        Command="{Binding GuardarConfiguracoesCommand}"
                        Content="ðŸ’¾ Guardar"
                        Style="{StaticResource NavigationButtonStyle}" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
