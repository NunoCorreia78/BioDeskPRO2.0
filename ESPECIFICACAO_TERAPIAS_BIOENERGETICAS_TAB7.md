# üåø BioDesk Tab 7 ‚Äî Especifica√ß√£o T√©cnica Completa (v1)
**Data**: 12 de Outubro de 2025
**Origem**: Plano ChatGPT (sess√£o 68ebfc22-6a80-8011-9861-f9e2899b60d9)
**Status**: üìã PLANEADO - Aguarda Implementa√ß√£o

> Implementa√ß√£o integral do m√≥dulo de **Terapias Bioenerg√©ticas** "tipo CoRe 5.0, mas moderno", com avalia√ß√£o (Value %), Improvement %, protocolos em Excel, controlo de voltagem/corrente/frequ√™ncia (AWG TiePie HS3), biofeedback fisiol√≥gico e suporte opcional a RNG f√≠sico (Alea/Hologram Generator).

---

## 1) Objetivo & √Çmbito

* Replicar o **fluxo funcional do Inergetix-CoRe v5.0** (Resonant Frequencies, Biofeedback, Frequency Program) com UI moderna, seguran√ßa cl√≠nica e rastreabilidade total.
* Incluir **3 modos de opera√ß√£o**: determin√≠stico (seed por sess√£o), **RNG f√≠sico Alea** (CoRe-like), e **biofeedback fisiol√≥gico** (recomendado) usando o TiePie HS3.
* Importar/gerir **protocolos** via Excel (idempot√™ncia por `ExternalId`).
* Produzir **relat√≥rios** com Value % iniciais e Improvement % finais + par√¢metros emitidos.

---

## 2) Fluxo funcional (espelhado do CoRe)

1. **Abrir ficha do paciente** (pr√©-requisito).
2. **Avalia√ß√£o (Resonant-like)**: gerar lista ordenada por **Value %** (topo = 100%; limiar configur√°vel, ex. >30%).
3. **Sele√ß√£o** de itens e **cria√ß√£o de fila** de emiss√£o (ou uso direto de **Frequency Program/Excel**).
4. **Execu√ß√£o sequencial** (n√£o mistura ondas) com controlo de **Frequ√™ncia/Amplitude/Forma/Canal/Tempo**.
5. **Improvement % em tempo real** durante a emiss√£o; quando ~100%, **desmarcar e seguir**.
6. **Fecho e relat√≥rio**: Value % inicial, Improvement % final, par√¢metros, tempo total, notas.

---

## 3) Modos de "fonte de aleatoriedade"

* **A) Determin√≠stico (CSPRNG + seed por sess√£o)**: reprodutibilidade/auditoria; seed √∫nica por sess√£o (derivada de SessaoId/DataHora).
* **B) RNG f√≠sico (Alea/Hologram)**: "CoRe-like" (n√£o reprodut√≠vel), opcional e autom√°tico quando o dispositivo √© detetado.
* **C) Fisiol√≥gico**: sem RNG ‚Äî avalia√ß√£o/ajuste pela resposta medida (RMS, Pico, FFT, Imped√¢ncia/GSR).

Padr√£o: **Fisiol√≥gico ON** + **Alea se presente**; fallback para **Determin√≠stico**.

---

## 4) Arquitetura

* **.NET 8 LTS** ¬∑ **WPF** ¬∑ **MVVM (CommunityToolkit.Mvvm)** ¬∑ **EF Core + SQLite** ¬∑ **Repository + Unit of Work** ¬∑ **FluentValidation** ¬∑ **ILogger**.
* **Servi√ßos**: `IMedicaoService` (medi√ß√£o + AWG), `IRandomSource`, `IExcelImportService`, `IProtocoloService`, `ISessaoService`.
* **UI**: Tab 7 (`TerapiasUserControl`), **LiveCharts2** para tempo real + FFT.
* **Threads**: captura em background (Task + `CancellationToken`), comunica√ß√£o via `Channels`.

### 4.1 Diagrama (alto n√≠vel)

```
UI (TerapiasUserControl)
  ‚Üï (bindings/commands)
ViewModel (TerapiasViewModel)
  ‚Üî IMedicaoService (TiePieService/Mock)
  ‚Üî IProtocoloService (carrega/resolve sequ√™ncia)
  ‚Üî IRandomSource (Alea | Deterministic | System)
  ‚Üî IExcelImportService (EPPlus/ClosedXML)
  ‚Üî ISessaoService (persist√™ncia, relat√≥rios)
  ‚Üî ILogger / IValidator
```

---

## 5) Modelo de Dom√≠nio (BD)

**Tabelas (principais)**

* `Paciente` (j√° existente) ‚úÖ
* `Sessao` (j√° existente) ‚úÖ
* `PlanoTerapia` *(ex-TerapiaProgramada)*: Id, Nome, Categoria, Notas, VersaoSchema, CreatedAt/By, etc.
* `ProtocoloTerapeutico`: Id, Nome, Categoria, Fonte (Excel/Custom), JsonParametros, Versao, Hash.
* `Terapia` (cat√°logo base): Id, Nome, Categoria, ResumoParametros.
* `SessaoTerapia`: Id, SessaoId (FK), ProtocoloId (FK), Status (Pendente/EmCurso/Conclu√≠da/Cancelada), Canal, Forma, FrequenciaHz, AmplitudeV, LimiteCorrenteMa, DuracaoMin, Ordem, StartedAt, EndedAt, ImprovementFinal, ValueInicial, RngInfo, AlgVersao, ConsentimentoId, DispositivoSerial, CreatedAt/By, ModifiedAt/By, SoftDelete.
* `LeituraBioenergetica`: Id, SessaoTerapiaId (FK), SampleRate, Canal, PathBruto, Rms, Pico, FreqDominante, EspectroResumoJson, Inicio, Fim.
* `EventoHardware`: Id, SessaoId, Tipo (Connected/Disconnected/Error/Overlimit), Detalhe, Timestamp.
* `ImportacaoExcelLog`: Id, Arquivo, VersaoSchema, LinhasOk, WarningsJson, ErrosJson, Data.

**√çndices**: `SessaoTerapia(SessaoId, Ordem)`, `LeituraBioenergetica(SessaoTerapiaId)`, `ProtocoloTerapeutico(Nome)`, `ImportacaoExcelLog(Data)`.

**Armazenamento bruto**: amostras **fora da BD** (ficheiro `.bin` ou `.csv.gz`) em `Data/Sessions/{SessaoId}/{SessaoTerapiaId}.bin`; BD guarda o **path** + estat√≠sticas.

---

## 6) Integra√ß√£o Hardware ‚Äî TiePie HS3

* **Descoberta**: enumerar dispositivos, obter **serial**, capacidades (AWG, faixas, sample rates).
* **Captura**: iniciar leitura em **thread** dedicada, buffer circular, downsampling para UI.
* **AWG/Output**: configurar forma (Sine/Square/Triangle/Saw), Hz, Vpp, offset, duty, canal; iniciar/pausar/parar.
* **Seguran√ßa**: **limites hard** (ex. AmplitudeV ‚â§ 20 V; LimiteCorrenteMa ‚â§ 50 mA).
* **Eventos**: Connected/Disconnected/Overlimit/Error ‚Üí UI.

**Interface (essencial)**

```csharp
public interface IMedicaoService {
    DeviceInfo DispositivoAtual { get; }
    Task<bool> ProcurarAsync(CancellationToken ct);
    Task ConectarAsync(string serial, CancellationToken ct);
    Task DesconectarAsync();

    // Captura
    IAsyncEnumerable<LeituraAmostra> LerAsync(LeituraConfig cfg, CancellationToken ct);

    // AWG / Output
    Task IniciarEmissaoAsync(SaidaConfig cfg, CancellationToken ct);
    Task PausarEmissaoAsync();
    Task PararEmissaoAsync();
}
```

---

## 7) RNG & Seeds

**Interface**

```csharp
public interface IRandomSource {
    void NextBytes(Span<byte> buffer);
    string Id { get; } // "DeterministicCSPRNG:v1", "AleaRNG:v1", "SystemRNG"
}
```

**Implementa√ß√µes**

* `DeterministicCsprng(seed: byte[32])` ‚Äî **seed guardada** por sess√£o (`ScanSeedHex`).
* `AleaRngSource` ‚Äî integra o teu Alea (se ligado).
* `SystemRngSource` ‚Äî fallback.

**Estrat√©gia por sess√£o**:

```
if (AleaDetetado) rng = AleaRng;
else rng = DeterministicCsprng(SeedSessao);
```

SeedSessao = HMAC(appSecret, PacienteId|SessaoId|DataHoraISO).

---

## 8) Algoritmos

### 8.1 Value % (Resonant-like)

* **Determin√≠stico/Alea**: usa RNG para gerar um score-base por item (est√°vel por sess√£o) e normaliza para [0..100].
* **Fisiol√≥gico**: realiza **mini-sweeps** (r√°pidos) e calcula score por **melhoria de m√©tricas** (queda de RMS, pico espectral pontiagudo, varia√ß√£o de imped√¢ncia).
* **Peso combinado** (se ambos ativos): `Score = w_rng*ScoreRng + w_phys*ScorePhys` (configur√°vel).
* **Ordena√ß√£o**: desc a 100%; **limiar default 30%**.

### 8.2 Improvement % (durante emiss√£o)

**M√©tricas**: RMS(t), Pico(t), FreqDom(t), Espectralidade/Entropia(t), Imped√¢ncia/GSR(t).
**EMA**: `emaX(t) = Œ±*X(t) + (1-Œ±)*emaX(t-1)` (Œ±‚âà0.2).
**Heur√≠stica** (exemplo):

```
base = clamp01((RMS0 - RMSt)/RMS0) * 0.4
     + clamp01((Pico0 - Picot)/Pico0) * 0.2
     + clamp01(|FreqDomShift|/limiarHz) * 0.2
     + clamp01((GSRt - GSR0)/escalaGSR) * 0.2
Improvement% = round(100 * clamp01(base))
```

Quando `Improvement% ‚â• alvo` (ex. 95‚Äì100), **auto-desmarcar** item e seguir o pr√≥ximo.

---

## 9) Excel v1 ‚Äî Schema & Valida√ß√£o

**Colunas**

* `ExternalId` (GUID) ‚Äî **idempot√™ncia**
* `Nome` (string, obrigat√≥rio)
* `Categoria` (string)
* `FrequenciaHz` (decimal > 0)
* `AmplitudeV` (decimal 0..20)
* `LimiteCorrenteMa` (int 0..50)
* `FormaOnda` (enum: Sine|Square|Triangle|Saw)
* `Modulacao` (enum: None|AM|FM|Burst)
* `DuracaoMin` (int 1..180)
* `Canal` (string/int)
* `SequenciaJSON` (JSON opcional: etapas com Hz/min/amp)
* `Contraindicacoes` (string)
* `Notas` (string)
* `Versao` (int)

**Valida√ß√£o (FluentValidation)**

* Campos obrigat√≥rios, ranges, enums v√°lidos;
* **Pr√©-visualiza√ß√£o** no UI; relat√≥rio com **OK/Warnings/Erros**, **Upsert** por `ExternalId`.

---

## 10) UI/UX (Tab 7)

* **Topo**: Estado do Dispositivo ¬∑ Consentimento ¬∑ Paciente ¬∑ A√ß√µes (Abrir Consentimento/Exportar Sess√£o).
* **Coluna 1**: Cat√°logo + Pesquisa ¬∑ **Importar Excel** ¬∑ **Fila (Plano de Terapia)** com `Ordem/Nome/Hz/V/mA/Min` + a√ß√µes (Adicionar/Remover/Guardar como Protocolo).
* **Coluna 2**: Controlo de Sa√≠da (Amplitude, Corrente, Frequ√™ncia, Forma, Modula√ß√£o, Canal) + Bot√µes (Iniciar/Pausar/Parar) ¬∑ **Biofeedback** (Imped√¢ncia, GSR, Mensagens).
* **Coluna 3**: **Gr√°fico tempo real** (LiveCharts2) ¬∑ **FFT** ¬∑ Indicadores (Freq. Dom, Pico, RMS, Tempo) ¬∑ **Improvement %** por item.
* **Checklist pr√©‚Äësess√£o**: consentimento OK, dispositivo pronto, protocolo v√°lido, limites seguros ‚Üí s√≥ ent√£o habilita "Iniciar".
* **Acessibilidade**: textos leg√≠veis, contraste suficiente, tamanhos de clique ‚â• 36 px.

---

## 11) ViewModel (resumo de propriedades/comandos)

```csharp
class TerapiasViewModel : ObservableObject {
  // Estado
  public string EstadoDispositivo { get; }
  public string DispositivoNome { get; }
  public bool PodeIniciar { get; }
  public bool SessaoEmCurso { get; }

  // Cat√°logo & Fila
  public ObservableCollection<TerapiaDto> TerapiasFiltradas { get; }
  public TerapiaDto? TerapiaSelecionada { get; set; }
  public ObservableCollection<ItemFilaDto> FilaTerapias { get; }

  // Controlo
  public double AmplitudeV { get; set; }
  public int LimiteCorrenteMa { get; set; }
  public double FrequenciaHz { get; set; }
  public string FormaOndaSelecionada { get; set; }
  public string CanalSelecionado { get; set; }

  // Medi√ß√µes/Indicadores
  public double Rms { get; }
  public double AmplitudePico { get; }
  public double FrequenciaDominante { get; }
  public TimeSpan TempoDecorrido { get; }

  // Comandos
  public IRelayCommand ImportarExcelCommand { get; }
  public IRelayCommand AdicionarTerapiaSelecionadaCommand { get; }
  public IRelayCommand GuardarFilaComoProtocoloCommand { get; }
  public IRelayCommand IniciarSessaoCommand { get; }
  public IRelayCommand PausarSessaoCommand { get; }
  public IRelayCommand PararSessaoCommand { get; }
}
```

---

## 12) Logging & Erros

* **Categorias**: `Hardware`, `Algoritmo`, `Importacao`, `Persistencia`, `UI`.
* **C√≥digos**: `HW_TIMEOUT`, `HW_DISCONNECTED`, `HW_OVERLIMIT`, `IMPORT_SCHEMA_INVALID`, `IMPORT_DUPLICATE_ID`, `ALGO_CONFIG_INVALID`.
* **UI**: banners leg√≠veis e a√ß√µes de retry.
* **Anexar logs** √† sess√£o em caso de falha.

---

## 13) Seguran√ßa & GDPR

* **Consentimento** obrigat√≥rio ligado a cada `SessaoTerapia` (hash SHA256 do PDF assinado + timestamp + c√©dula profissional).
* **Minimiza√ß√£o**: guardar bruto apenas quando justific√°vel; **reten√ß√£o** configur√°vel; export "Right to Access".
* **Audit trail**: Created/Modified/Deleted (soft) + utilizador respons√°vel.

---

## 14) Testes

* **Unit**: ViewModel, validadores, importador, calculadora de Value%/Improvement%.
* **Contract**: `IMedicaoService` (TiePie vs Mock) ‚Äî mesmas assinaturas/comportamentos esperados.
* **Golden tests**: ficheiros de amostra ‚Üí resultado esperado (para n√£o "partir" o algoritmo).
* **Hardware-in-the-loop**: script l√™ 10 s @1 kHz e valida SNR/lat√™ncia.
* **UI Smoke**: inicializa√ß√£o com Mock + bindings b√°sicos OK.

---

## 15) Performance

* **Buffer ring** com backpressure para UI.
* **Downsampling** para gr√°ficos; armazenamento bruto sem passar pela UI.
* **LiveCharts2**: s√©ries reusadas; limitar pontos vis√≠veis; `EnableAnimations=false` em tempo real.

---

## 16) Deployment

* **Installer**: MSIX/WiX; pergunta pasta de dados; cria `Data/` e `Logs/`.
* **Pr√©‚Äërequisitos**: .NET 8, driver TiePie, permiss√µes de USB.
* **Config**: `appsettings.json` (limites V/mA, paths, flags RNG/biofeedback, paleta).
* **Paths**: dados por utilizador em `%ProgramData%/BioDesk/` ou `%LOCALAPPDATA%/BioDesk/`.

---

## 17) Versionamento & Migra√ß√£o

* **SemVer** de app e **AlgoritmoVersao** (guardado na sess√£o).
* EF Core **Migrations**; compatibilidade ascend./descend. de Excel (campo `Versao`).

---

## 18) Riscos & Mitiga√ß√µes

* **Depend√™ncia Alea** (descontinuado) ‚Üí opcional; fallback deterministic.
* **Carga de CPU** (FFT) ‚Üí usar FFT otimizadas e janelas curtas; limitar FPS gr√°fico.
* **Seguran√ßa el√©trica** ‚Üí limites hard V/mA; check de imped√¢ncia e pausa autom√°tica.
* **Dados volumosos** ‚Üí ficheiro externo por sess√£o + compress√£o.

---

## 19) "Defini√ß√£o de Feito" (Tab 7)

1. ‚úÖ Lista **Value %** (limiar 30%) + **Fila** + execu√ß√£o **sequencial**.
2. ‚úÖ **Improvement %** ao vivo por item; auto‚Äëdesmarcar ao atingir alvo.
3. ‚úÖ AWG TiePie a emitir com controlo de Hz/V/Forma/Canal/Tempo; **limites hard**.
4. ‚úÖ Importa√ß√£o Excel v1 **idempotente** + relat√≥rio e pr√©‚Äëvisualiza√ß√£o.
5. ‚úÖ Sess√£o gravada: metadados, ficheiro bruto, estat√≠sticas, consentimento, Rng/Seed/AlgVersao.
6. ‚úÖ Logs estruturados + mensagens de erro claras.

---

## 20) Estimativas (refer√™ncia)

* Entidades/BD: 4‚Äì6 h
* Abstra√ß√£o hardware + Mock: 3‚Äì4 h
* TiePie Service (captura + AWG): 6‚Äì10 h
* Algoritmos (Value/Improvement) + testes: 6‚Äì8 h
* Importador Excel + valida√ß√£o + UI pr√©‚Äëview: 5‚Äì7 h
* UI Tab 7 completa (LiveCharts2 + FFT + estados + hist√≥rico): 12‚Äì16 h
* Relat√≥rios + export: 3‚Äì4 h
* Documenta√ß√£o final + runbook: 3‚Äì4 h

**Total**: ~42‚Äì59 h (vari√°vel com drivers/FFT e polimento de UI).

---

## 21) Snippets essenciais

### 21.1 Deterministic CSPRNG (seed)

```csharp
public sealed class DeterministicCsprng : IRandomSource, IDisposable {
  private readonly HMACSHA256 _hmac; private ulong _ctr;
  public string Id => "DeterministicCSPRNG:v1";
  public DeterministicCsprng(ReadOnlySpan<byte> seed) {
    var key = SHA256.HashData(seed); _hmac = new HMACSHA256(key);
  }
  public void NextBytes(Span<byte> buffer) {
    int off=0; Span<byte> blk=stackalloc byte[32];
    while(off<buffer.Length){ Span<byte> ctr=stackalloc byte[8];
      BitConverter.TryWriteBytes(ctr,_ctr); if(BitConverter.IsLittleEndian) ctr.Reverse();
      _hmac.TryComputeHash(ctr, blk, out _); int n=Math.Min(blk.Length, buffer.Length-off);
      blk[..n].CopyTo(buffer.Slice(off,n)); off+=n; _ctr++; }
  }
  public void Dispose()=>_hmac.Dispose();
}
```

### 21.2 IMedicaoService (assinaturas base)

```csharp
public record LeituraConfig(double SampleRate, string Canal, TimeSpan Janela);
public record SaidaConfig(double FrequenciaHz, double AmplitudeV, string Forma, string Canal, double? LimiteCorrenteMa, TimeSpan Duracao);
public record LeituraAmostra(DateTimeOffset T, double Rms, double Pico, double FreqDom, double[]? Espectro);
```

### 21.3 Validador Excel (trecho)

```csharp
RuleFor(x=>x.Nome).NotEmpty();
RuleFor(x=>x.FrequenciaHz).GreaterThan(0);
RuleFor(x=>x.AmplitudeV).InclusiveBetween(0,20);
RuleFor(x=>x.LimiteCorrenteMa).InclusiveBetween(0,50);
RuleFor(x=>x.FormaOnda).Must(v=> new[]{"Sine","Square","Triangle","Saw"}.Contains(v));
```

---

## 22) Pr√≥ximos Passos

1. ‚úÖ Fechar **schema Excel v1** (ficheiro base + 5 exemplos).
2. ‚è∏Ô∏è Implementar **IMedicaoService** (Mock) + **LiveCharts2** com feed em tempo real.
3. ‚è∏Ô∏è Implementar **Value % + Improvement %** (v1) com testes.
4. ‚è∏Ô∏è Integrar **TiePie HS3** (captura + AWG).
5. ‚è∏Ô∏è Ligar **importa√ß√£o Excel** e **relat√≥rios**.

---

## üîó Integra√ß√£o com Arquitetura BioDeskPro2 Existente

### ‚úÖ **COMPAT√çVEL COM INFRAESTRUTURA ATUAL**:

1. **Base de Dados**:
   - `Paciente` e `Sessao` j√° existem ‚úÖ
   - `TipoAbordagem.MedicinaBioenergetica` j√° definido ‚úÖ
   - EF Core Migrations prontas para novas tabelas

2. **Arquitetura MVVM**:
   - `ViewModelBase` com `ExecuteWithErrorHandlingAsync` ‚úÖ
   - `[ObservableProperty]` e `[RelayCommand]` CommunityToolkit ‚úÖ
   - Dependency Injection em `App.xaml.cs` ‚úÖ

3. **Padr√µes Estabelecidos**:
   - Repository Pattern + UnitOfWork ‚úÖ
   - FluentValidation para regras de neg√≥cio ‚úÖ
   - PathService para gest√£o de ficheiros ‚úÖ
   - ILogger estruturado ‚úÖ

### üÜï **NOVAS DEPEND√äNCIAS NECESS√ÅRIAS**:

1. **LiveCharts2**: Gr√°ficos tempo real
   ```bash
   dotnet add package LiveChartsCore.SkiaSharpView.WPF
   ```

2. **Excel Import**: EPPlus ou ClosedXML
   ```bash
   dotnet add package EPPlus --version 7.0.0
   # ou
   dotnet add package ClosedXML --version 0.102.0
   ```

3. **TiePie SDK**: Driver C# (wrapper nativo)
   - Requer SDK do fabricante + wrapper .NET

4. **FFT Library**: Math.NET Numerics
   ```bash
   dotnet add package MathNet.Numerics --version 5.0.0
   ```

---

## üìã Estrutura de Pastas Proposta

```
src/
‚îú‚îÄ‚îÄ BioDesk.Domain/
‚îÇ   ‚îî‚îÄ‚îÄ Entities/
‚îÇ       ‚îú‚îÄ‚îÄ PlanoTerapia.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ ProtocoloTerapeutico.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ Terapia.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ SessaoTerapia.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ LeituraBioenergetica.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ EventoHardware.cs (NOVO)
‚îÇ       ‚îî‚îÄ‚îÄ ImportacaoExcelLog.cs (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ BioDesk.Data/
‚îÇ   ‚îú‚îÄ‚îÄ Migrations/ (7 novas migrations)
‚îÇ   ‚îî‚îÄ‚îÄ Repositories/
‚îÇ       ‚îú‚îÄ‚îÄ ITerapiaRepository.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ IProtocoloRepository.cs (NOVO)
‚îÇ       ‚îî‚îÄ‚îÄ ISessaoTerapiaRepository.cs (NOVO)
‚îÇ
‚îú‚îÄ‚îÄ BioDesk.Services/
‚îÇ   ‚îú‚îÄ‚îÄ Medicao/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IMedicaoService.cs (NOVO)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TiePieService.cs (NOVO)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ MockMedicaoService.cs (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ RNG/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IRandomSource.cs (NOVO)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeterministicCsprng.cs (NOVO)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AleaRngSource.cs (NOVO - opcional)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SystemRngSource.cs (NOVO)
‚îÇ   ‚îú‚îÄ‚îÄ Excel/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IExcelImportService.cs (NOVO)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ExcelImportService.cs (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ Terapias/
‚îÇ       ‚îú‚îÄ‚îÄ IProtocoloService.cs (NOVO)
‚îÇ       ‚îú‚îÄ‚îÄ ProtocoloService.cs (NOVO)
‚îÇ       ‚îî‚îÄ‚îÄ AlgoritmosService.cs (NOVO - Value%/Improvement%)
‚îÇ
‚îú‚îÄ‚îÄ BioDesk.ViewModels/
‚îÇ   ‚îú‚îÄ‚îÄ Abas/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TerapiasViewModel.cs (NOVO)
‚îÇ   ‚îî‚îÄ‚îÄ Validators/
‚îÇ       ‚îî‚îÄ‚îÄ ProtocoloExcelValidator.cs (NOVO)
‚îÇ
‚îî‚îÄ‚îÄ BioDesk.App/
    ‚îî‚îÄ‚îÄ Views/
        ‚îî‚îÄ‚îÄ Abas/
            ‚îî‚îÄ‚îÄ TerapiasUserControl.xaml (NOVO)
```

---

## ‚ö†Ô∏è DECIS√ïES CR√çTICAS ANTES DE INICIAR

### 1. **Hardware TiePie HS3**
- ‚ùì Tem o dispositivo fisicamente dispon√≠vel?
- ‚ùì SDK/Drivers instalados e testados?
- ‚ùì Documenta√ß√£o API dispon√≠vel?

**Recomenda√ß√£o**: Iniciar com **MockMedicaoService** e testar UI/algoritmos **SEM hardware** primeiro.

### 2. **Alea RNG (Opcional)**
- ‚ùì Dispositivo dispon√≠vel?
- ‚ùì SDK/API dispon√≠vel?

**Recomenda√ß√£o**: Implementar apenas **DeterministicCsprng** inicialmente (suficiente para auditorias).

### 3. **Excel Schema Definitivo**
- ‚ùì Tem exemplos de protocolos reais em Excel?
- ‚ùì Campos adicionais necess√°rios al√©m dos especificados?

**Recomenda√ß√£o**: Criar **template Excel v1.0** com 5 protocolos exemplo antes de codificar.

### 4. **Prioridade de Implementa√ß√£o**
**Op√ß√£o A - MVP R√°pido (2-3 semanas)**:
1. UI b√°sica + Mock (sem hardware)
2. Algoritmos Value%/Improvement% (modo determin√≠stico)
3. Importa√ß√£o Excel
4. Relat√≥rios simples

**Op√ß√£o B - Completo (6-8 semanas)**:
1. Todas as tabelas BD
2. TiePie integration completa
3. LiveCharts2 + FFT tempo real
4. RNG f√≠sico Alea
5. Relat√≥rios avan√ßados + export

---

## üöÄ PR√ìXIMO PASSO IMEDIATO

Escolha UMA op√ß√£o:

### **A) Come√ßar MVP (SEM hardware)** ‚úÖ RECOMENDADO
```bash
1. Criar entidades BD b√°sicas (PlanoTerapia, ProtocoloTerapeutico, SessaoTerapia)
2. Migration EF Core
3. MockMedicaoService (retorna dados sint√©ticos)
4. UI Tab 7 b√°sica (sem gr√°ficos tempo real)
5. Algoritmo Value% determin√≠stico
6. Importador Excel v1
```
**Tempo**: 2-3 semanas
**Vantagem**: Funcional rapidamente, test√°vel sem hardware

### **B) Aguardar Decis√µes** ‚è∏Ô∏è
Responder √†s 4 perguntas cr√≠ticas acima antes de come√ßar.

### **C) Criar Template Excel Primeiro** üìä
Definir schema Excel definitivo com 5-10 protocolos exemplo.

---

**Qual op√ß√£o prefere para come√ßar?** ü§î
